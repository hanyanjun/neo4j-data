/*! For license information please see neo4j-data.min.js.LICENSE */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports["neo4j-data"]=t():e["neo4j-data"]=t()}(window,(function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";n.r(t);var r=n(1);t.default=r.default},function(e,t,n){"use strict";n.r(t);var r=n(2);const i=n(3).v1;t.default=class{constructor(){this.session="",this.driver=""}config({url:e,username:t,password:n}){const r=i.driver(e,i.auth.basic(t,n)),o=r.session();this.session=o,this.driver=r}runMatch(e){return this.session.run(e)}dataDetail(e){return Object(r.dataDetail)(e)}close(){this.session.close(),this.driver.close()}}},function(e,t,n){"use strict";n.r(t),n.d(t,"dataDetail",(function(){return f}));var r=n(3),i=n(93);const o=(e,t)=>{let n=e.segments;return(!Array.isArray(e.segments)||e.segments.length<1)&&(n=[{...e,end:null}]),n.map((function(e){return[s(e.start,t),s(e.relationship,t),s(e.end,t)].filter(e=>null!==e)}))};function a(e,t){return e instanceof r.v1.types.Node||e instanceof r.v1.types.Relationship?e.properties:e instanceof r.v1.types.Path?[].concat.apply([],o(e,t)):e}const u=e=>e.reduce((e,t)=>Array.isArray(t)?e.concat(u(t)):e.concat(t),[]);function s(e,t){let n=t.objectConverter(e,t),r=null;return Array.isArray(n)?r=n.map(e=>l(e,t)):null!==n&&"object"==typeof n&&(r={},Object.keys(n).forEach(e=>{r[e]=l(n[e],t)})),r}const c=(e,t)=>t instanceof e.Node?t:t instanceof e.Relationship?t:t instanceof e.Path?t:Array.isArray(t)?t.map(t=>c(e,t)):-1===["number","string","boolean"].indexOf(typeof t)&&(null!==t&&("object"==typeof t?Object.keys(t).map(n=>c(e,t[n])):t));function l(e,t){const n=Object(i.stringFormat)(e);return n||(t.intChecker(e)?t.intConverter(e):Array.isArray(e)?function(e,t){return e.map(e=>l(e,t))}(e,t):-1!==["number","string","boolean"].indexOf(typeof e)?e:null===e?e:"object"==typeof e?s(e,t):void 0)}const f=e=>{if(0===e.length)return{nodes:[],relationships:[],nodesMap:{},relationshipsMap:{}};let t=r.v1.types,n=e[0].keys,i=[],o=[];const s={intChecker:r.v1.isInt,intConverter:e=>e.toString(),objectConverter:a};e.forEach(e=>{let r=n.map(t=>e.get(t));r=u(c(t,r)).filter(e=>!1!==e),i=[...i,...r.filter(e=>e instanceof t.Node)],o=[...o,...r.filter(e=>e instanceof t.Relationship)],r.filter(e=>e instanceof t.Path).forEach(e=>((e,t,n)=>{(Array.isArray(e)?e:[e]).forEach(e=>{let r=e.segments;(!Array.isArray(e.segments)||e.segments.length<1)&&(r=[{...e,end:null}]),r.forEach(e=>{e.start&&t.push(e.start),e.end&&t.push(e.end),e.relationship&&n.push(e.relationship)})})})(e,i,o))});let f={},h={};const d=i.map(e=>{let t={id:e.identity.toString(),labels:e.labels,properties:l(e.properties,s)};return f[e.identity.toString()]=t,t});let v=o;return v=(v=o.filter(e=>d.filter(t=>t.id===e.start.toString()).length>0&&d.filter(t=>t.id===e.end.toString()).length>0)).map(e=>{let t={id:e.identity.toString(),startNodeId:e.start.toString(),endNodeId:e.end.toString(),type:e.type,properties:l(e.properties,s)};return h[e.identity.toString()]=t,t}),{nodes:d,relationships:v,nodesMap:f,relationshipsMap:h}}},function(e,t,n){"use strict";var r=n(4);Object.defineProperty(t,"__esModule",{value:!0}),t.v1=t.default=void 0;var i=r(n(5));t.v1=i;var o=i;t.default=o},function(e,t){function n(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return n=function(){return e},e}e.exports=function(e){if(e&&e.__esModule)return e;var t=n();if(t&&t.has(e))return t.get(e);var r={};if(null!=e){var i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var a=i?Object.getOwnPropertyDescriptor(e,o):null;a&&(a.get||a.set)?Object.defineProperty(r,o,a):r[o]=e[o]}}return r.default=e,t&&t.set(e,r),r}},function(e,t,n){"use strict";(function(e){var r=n(7),i=n(4);Object.defineProperty(t,"__esModule",{value:!0}),t.driver=E,Object.defineProperty(t,"int",{enumerable:!0,get:function(){return o.int}}),Object.defineProperty(t,"isInt",{enumerable:!0,get:function(){return o.isInt}}),Object.defineProperty(t,"Neo4jError",{enumerable:!0,get:function(){return u.Neo4jError}}),Object.defineProperty(t,"isPoint",{enumerable:!0,get:function(){return y.isPoint}}),Object.defineProperty(t,"isDate",{enumerable:!0,get:function(){return g.isDate}}),Object.defineProperty(t,"isDateTime",{enumerable:!0,get:function(){return g.isDateTime}}),Object.defineProperty(t,"isDuration",{enumerable:!0,get:function(){return g.isDuration}}),Object.defineProperty(t,"isLocalDateTime",{enumerable:!0,get:function(){return g.isLocalDateTime}}),Object.defineProperty(t,"isLocalTime",{enumerable:!0,get:function(){return g.isLocalTime}}),Object.defineProperty(t,"isTime",{enumerable:!0,get:function(){return g.isTime}}),t.default=t.temporal=t.spatial=t.error=t.session=t.types=t.logging=t.auth=t.integer=void 0;var o=i(n(8)),a=n(21),u=n(11),s=r(n(22)),c=r(n(23)),l=r(n(25)),f=n(26),h=r(n(81)),d=r(n(87)),v=n(32),_=r(n(77)),p=r(n(88)),y=n(60),g=n(61),m=r(n(76)),b={basic:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;return n?{scheme:"basic",principal:e,credentials:t,realm:n}:{scheme:"basic",principal:e,credentials:t}},kerberos:function(e){return{scheme:"kerberos",principal:"",credentials:e}},custom:function(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:void 0;return i?{scheme:r,principal:e,credentials:t,realm:n,parameters:i}:{scheme:r,principal:e,credentials:t,realm:n}}};t.auth=b;var k="neo4j-javascript/"+d.default,w={console:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(t){return{level:t,logger:function(t,n){return console.log("".concat(e.Date.now()," ").concat(t.toUpperCase()," ").concat(n))}}}))};function E(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};(0,v.assertString)(e,"Bolt URL");var r=_.default.parseDatabaseUrl(e);if(-1!==["bolt+routing","neo4j"].indexOf(r.scheme))return new h.default(m.default.fromUrl(r.hostAndPort),r.query,k,t,n);if("bolt"===r.scheme){if(!(0,v.isEmptyObjectOrNull)(r.query))throw new Error("Parameters are not supported with scheme 'bolt'. Given URL: '".concat(e,"'"));return new f.Driver(m.default.fromUrl(r.hostAndPort),k,t,n)}if("http"===r.scheme||"https"===r.scheme)return new p.default(r,k,t,n);throw new Error("Unknown scheme: ".concat(r.scheme))}t.logging=w;var I={Node:a.Node,Relationship:a.Relationship,UnboundRelationship:a.UnboundRelationship,PathSegment:a.PathSegment,Path:a.Path,Result:s.default,ResultSummary:c.default,Record:l.default,Point:y.Point,Date:g.Date,DateTime:g.DateTime,Duration:g.Duration,LocalDateTime:g.LocalDateTime,LocalTime:g.LocalTime,Time:g.Time,Integer:o.default};t.types=I;var S={READ:f.READ,WRITE:f.WRITE};t.session=S;var O={SERVICE_UNAVAILABLE:u.SERVICE_UNAVAILABLE,SESSION_EXPIRED:u.SESSION_EXPIRED,PROTOCOL_ERROR:u.PROTOCOL_ERROR};t.error=O;var T={toNumber:o.toNumber,toString:o.toString,inSafeRange:o.inSafeRange};t.integer=T;var C={isPoint:y.isPoint};t.spatial=C;var R={isDuration:g.isDuration,isLocalTime:g.isLocalTime,isTime:g.isTime,isDate:g.isDate,isLocalDateTime:g.isLocalDateTime,isDateTime:g.isDateTime};t.temporal=R;var N={driver:E,int:o.int,isInt:o.isInt,isPoint:y.isPoint,isDuration:g.isDuration,isLocalTime:g.isLocalTime,isTime:g.isTime,isDate:g.isDate,isLocalDateTime:g.isLocalDateTime,isDateTime:g.isDateTime,integer:T,Neo4jError:u.Neo4jError,auth:b,logging:w,types:I,session:S,error:O,spatial:C,temporal:R};t.default=N}).call(this,n(6))},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t){e.exports=function(e){return e&&e.__esModule?e:{default:e}}},function(e,t,n){"use strict";var r=n(7);Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.toString=t.toNumber=t.inSafeRange=t.isInt=t.int=void 0;var i=r(n(9)),o=r(n(10)),a=n(11),u=function(){function e(t,n){(0,i.default)(this,e),this.low=0|t,this.high=0|n}return(0,o.default)(e,[{key:"inSafeRange",value:function(){return this.greaterThanOrEqual(e.MIN_SAFE_VALUE)&&this.lessThanOrEqual(e.MAX_SAFE_VALUE)}},{key:"toInt",value:function(){return this.low}},{key:"toNumber",value:function(){return this.high*c+(this.low>>>0)}},{key:"toNumberOrInfinity",value:function(){return this.lessThan(e.MIN_SAFE_VALUE)?Number.NEGATIVE_INFINITY:this.greaterThan(e.MAX_SAFE_VALUE)?Number.POSITIVE_INFINITY:this.toNumber()}},{key:"toString",value:function(t){if((t=t||10)<2||t>36)throw RangeError("radix out of range: "+t);if(this.isZero())return"0";var n;if(this.isNegative()){if(this.equals(e.MIN_VALUE)){var r=e.fromNumber(t),i=this.div(r);return n=i.multiply(r).subtract(this),i.toString(t)+n.toInt().toString(t)}return"-"+this.negate().toString(t)}var o=e.fromNumber(Math.pow(t,6));n=this;for(var a="";;){var u=n.div(o),s=(n.subtract(u.multiply(o)).toInt()>>>0).toString(t);if((n=u).isZero())return s+a;for(;s.length<6;)s="0"+s;a=""+s+a}}},{key:"getHighBits",value:function(){return this.high}},{key:"getLowBits",value:function(){return this.low}},{key:"getNumBitsAbs",value:function(){if(this.isNegative())return this.equals(e.MIN_VALUE)?64:this.negate().getNumBitsAbs();for(var t=0!==this.high?this.high:this.low,n=31;n>0&&0==(t&1<<n);n--);return 0!==this.high?n+33:n+1}},{key:"isZero",value:function(){return 0===this.high&&0===this.low}},{key:"isNegative",value:function(){return this.high<0}},{key:"isPositive",value:function(){return this.high>=0}},{key:"isOdd",value:function(){return 1==(1&this.low)}},{key:"isEven",value:function(){return 0==(1&this.low)}},{key:"equals",value:function(t){return e.isInteger(t)||(t=e.fromValue(t)),this.high===t.high&&this.low===t.low}},{key:"notEquals",value:function(e){return!this.equals(e)}},{key:"lessThan",value:function(e){return this.compare(e)<0}},{key:"lessThanOrEqual",value:function(e){return this.compare(e)<=0}},{key:"greaterThan",value:function(e){return this.compare(e)>0}},{key:"greaterThanOrEqual",value:function(e){return this.compare(e)>=0}},{key:"compare",value:function(t){if(e.isInteger(t)||(t=e.fromValue(t)),this.equals(t))return 0;var n=this.isNegative(),r=t.isNegative();return n&&!r?-1:!n&&r?1:this.subtract(t).isNegative()?-1:1}},{key:"negate",value:function(){return this.equals(e.MIN_VALUE)?e.MIN_VALUE:this.not().add(e.ONE)}},{key:"add",value:function(t){e.isInteger(t)||(t=e.fromValue(t));var n=this.high>>>16,r=65535&this.high,i=this.low>>>16,o=65535&this.low,a=t.high>>>16,u=65535&t.high,s=t.low>>>16,c=0,l=0,f=0,h=0;return f+=(h+=o+(65535&t.low))>>>16,h&=65535,l+=(f+=i+s)>>>16,f&=65535,c+=(l+=r+u)>>>16,l&=65535,c+=n+a,c&=65535,e.fromBits(f<<16|h,c<<16|l)}},{key:"subtract",value:function(t){return e.isInteger(t)||(t=e.fromValue(t)),this.add(t.negate())}},{key:"multiply",value:function(t){if(this.isZero())return e.ZERO;if(e.isInteger(t)||(t=e.fromValue(t)),t.isZero())return e.ZERO;if(this.equals(e.MIN_VALUE))return t.isOdd()?e.MIN_VALUE:e.ZERO;if(t.equals(e.MIN_VALUE))return this.isOdd()?e.MIN_VALUE:e.ZERO;if(this.isNegative())return t.isNegative()?this.negate().multiply(t.negate()):this.negate().multiply(t).negate();if(t.isNegative())return this.multiply(t.negate()).negate();if(this.lessThan(f)&&t.lessThan(f))return e.fromNumber(this.toNumber()*t.toNumber());var n=this.high>>>16,r=65535&this.high,i=this.low>>>16,o=65535&this.low,a=t.high>>>16,u=65535&t.high,s=t.low>>>16,c=65535&t.low,l=0,h=0,d=0,v=0;return d+=(v+=o*c)>>>16,v&=65535,h+=(d+=i*c)>>>16,d&=65535,h+=(d+=o*s)>>>16,d&=65535,l+=(h+=r*c)>>>16,h&=65535,l+=(h+=i*s)>>>16,h&=65535,l+=(h+=o*u)>>>16,h&=65535,l+=n*c+r*s+i*u+o*a,l&=65535,e.fromBits(d<<16|v,l<<16|h)}},{key:"div",value:function(t){if(e.isInteger(t)||(t=e.fromValue(t)),t.isZero())throw(0,a.newError)("division by zero");if(this.isZero())return e.ZERO;var n,r,i;if(this.equals(e.MIN_VALUE))return t.equals(e.ONE)||t.equals(e.NEG_ONE)?e.MIN_VALUE:t.equals(e.MIN_VALUE)?e.ONE:(n=this.shiftRight(1).div(t).shiftLeft(1)).equals(e.ZERO)?t.isNegative()?e.ONE:e.NEG_ONE:(r=this.subtract(t.multiply(n)),i=n.add(r.div(t)));if(t.equals(e.MIN_VALUE))return e.ZERO;if(this.isNegative())return t.isNegative()?this.negate().div(t.negate()):this.negate().div(t).negate();if(t.isNegative())return this.div(t.negate()).negate();for(i=e.ZERO,r=this;r.greaterThanOrEqual(t);){n=Math.max(1,Math.floor(r.toNumber()/t.toNumber()));for(var o=Math.ceil(Math.log(n)/Math.LN2),u=o<=48?1:Math.pow(2,o-48),s=e.fromNumber(n),c=s.multiply(t);c.isNegative()||c.greaterThan(r);)n-=u,c=(s=e.fromNumber(n)).multiply(t);s.isZero()&&(s=e.ONE),i=i.add(s),r=r.subtract(c)}return i}},{key:"modulo",value:function(t){return e.isInteger(t)||(t=e.fromValue(t)),this.subtract(this.div(t).multiply(t))}},{key:"not",value:function(){return e.fromBits(~this.low,~this.high)}},{key:"and",value:function(t){return e.isInteger(t)||(t=e.fromValue(t)),e.fromBits(this.low&t.low,this.high&t.high)}},{key:"or",value:function(t){return e.isInteger(t)||(t=e.fromValue(t)),e.fromBits(this.low|t.low,this.high|t.high)}},{key:"xor",value:function(t){return e.isInteger(t)||(t=e.fromValue(t)),e.fromBits(this.low^t.low,this.high^t.high)}},{key:"shiftLeft",value:function(t){return e.isInteger(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?e.fromBits(this.low<<t,this.high<<t|this.low>>>32-t):e.fromBits(0,this.low<<t-32)}},{key:"shiftRight",value:function(t){return e.isInteger(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?e.fromBits(this.low>>>t|this.high<<32-t,this.high>>t):e.fromBits(this.high>>t-32,this.high>=0?0:-1)}}]),e}();u.__isInteger__=!0,Object.defineProperty(u.prototype,"__isInteger__",{value:!0,enumerable:!1,configurable:!1}),u.isInteger=function(e){return!0===(e&&e.__isInteger__)};var s={};u.fromInt=function(e){var t,n;return(e|=0)>=-128&&e<128&&(n=s[e])?n:(t=new u(e,e<0?-1:0,!1),e>=-128&&e<128&&(s[e]=t),t)},u.fromNumber=function(e){return isNaN(e)||!isFinite(e)?u.ZERO:e<=-l?u.MIN_VALUE:e+1>=l?u.MAX_VALUE:e<0?u.fromNumber(-e).negate():new u(e%c|0,e/c|0)},u.fromBits=function(e,t){return new u(e,t)},u.fromString=function(e,t){if(0===e.length)throw(0,a.newError)("number format error: empty string");if("NaN"===e||"Infinity"===e||"+Infinity"===e||"-Infinity"===e)return u.ZERO;if((t=t||10)<2||t>36)throw(0,a.newError)("radix out of range: "+t);var n;if((n=e.indexOf("-"))>0)throw(0,a.newError)('number format error: interior "-" character: '+e);if(0===n)return u.fromString(e.substring(1),t).negate();for(var r=u.fromNumber(Math.pow(t,8)),i=u.ZERO,o=0;o<e.length;o+=8){var s=Math.min(8,e.length-o),c=parseInt(e.substring(o,o+s),t);if(s<8){var l=u.fromNumber(Math.pow(t,s));i=i.multiply(l).add(u.fromNumber(c))}else i=(i=i.multiply(r)).add(u.fromNumber(c))}return i},u.fromValue=function(e){return e instanceof u?e:"number"==typeof e?u.fromNumber(e):"string"==typeof e?u.fromString(e):new u(e.low,e.high)},u.toNumber=function(e){return u.fromValue(e).toNumber()},u.toString=function(e,t){return u.fromValue(e).toString(t)},u.inSafeRange=function(e){return u.fromValue(e).inSafeRange()};var c=4294967296,l=c*c/2,f=u.fromInt(1<<24);u.ZERO=u.fromInt(0),u.ONE=u.fromInt(1),u.NEG_ONE=u.fromInt(-1),u.MAX_VALUE=u.fromBits(-1,2147483647,!1),u.MIN_VALUE=u.fromBits(0,-2147483648,!1),u.MIN_SAFE_VALUE=u.fromBits(1,-2097152),u.MAX_SAFE_VALUE=u.fromBits(-1,2097151);var h=u.fromValue;t.int=h;var d=u.isInteger;t.isInt=d;var v=u.inSafeRange;t.inSafeRange=v;var _=u.toNumber;t.toNumber=_;var p=u.toString;t.toString=p;var y=u;t.default=y},function(e,t){e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},function(e,t){function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}e.exports=function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}},function(e,t,n){"use strict";var r=n(7);Object.defineProperty(t,"__esModule",{value:!0}),t.newError=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"N/A";return new c(e,t)},t.PROTOCOL_ERROR=t.SESSION_EXPIRED=t.SERVICE_UNAVAILABLE=t.Neo4jError=void 0;var i=r(n(9)),o=r(n(12)),a=r(n(15)),u=r(n(16)),s=r(n(18));t.SERVICE_UNAVAILABLE="ServiceUnavailable";t.SESSION_EXPIRED="SessionExpired";t.PROTOCOL_ERROR="ProtocolError";var c=function(e){function t(e){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"N/A";return(0,i.default)(this,t),(n=(0,o.default)(this,(0,a.default)(t).call(this,e))).message=e,n.code=r,n.name="Neo4jError",n}return(0,u.default)(t,e),t}((0,s.default)(Error));t.Neo4jError=c},function(e,t,n){var r=n(13),i=n(14);e.exports=function(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?i(e):t}},function(e,t){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(t){return"function"==typeof Symbol&&"symbol"===n(Symbol.iterator)?e.exports=r=function(e){return n(e)}:e.exports=r=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":n(e)},r(t)}e.exports=r},function(e,t){e.exports=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}},function(e,t){function n(t){return e.exports=n=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},n(t)}e.exports=n},function(e,t,n){var r=n(17);e.exports=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&r(e,t)}},function(e,t){function n(t,r){return e.exports=n=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},n(t,r)}e.exports=n},function(e,t,n){var r=n(15),i=n(17),o=n(19),a=n(20);function u(t){var n="function"==typeof Map?new Map:void 0;return e.exports=u=function(e){if(null===e||!o(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==n){if(n.has(e))return n.get(e);n.set(e,t)}function t(){return a(e,arguments,r(this).constructor)}return t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),i(t,e)},u(t)}e.exports=u},function(e,t){e.exports=function(e){return-1!==Function.toString.call(e).indexOf("[native code]")}},function(e,t,n){var r=n(17);function i(t,n,o){return!function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}()?e.exports=i=function(e,t,n){var i=[null];i.push.apply(i,t);var o=new(Function.bind.apply(e,i));return n&&r(o,n.prototype),o}:e.exports=i=Reflect.construct,i.apply(null,arguments)}e.exports=i},function(e,t,n){"use strict";var r=n(7);Object.defineProperty(t,"__esModule",{value:!0}),t.PathSegment=t.Path=t.UnboundRelationship=t.Relationship=t.Node=void 0;var i=r(n(9)),o=r(n(10)),a=function(){function e(t,n,r){(0,i.default)(this,e),this.identity=t,this.labels=n,this.properties=r}return(0,o.default)(e,[{key:"toString",value:function(){for(var e="("+this.identity,t=0;t<this.labels.length;t++)e+=":"+this.labels[t];var n=Object.keys(this.properties);if(n.length>0){e+=" {";for(var r=0;r<n.length;r++)r>0&&(e+=","),e+=n[r]+":"+JSON.stringify(this.properties[n[r]]);e+="}"}return e+=")"}}]),e}();t.Node=a;var u=function(){function e(t,n,r,o,a){(0,i.default)(this,e),this.identity=t,this.start=n,this.end=r,this.type=o,this.properties=a}return(0,o.default)(e,[{key:"toString",value:function(){var e="("+this.start+")-[:"+this.type,t=Object.keys(this.properties);if(t.length>0){e+=" {";for(var n=0;n<t.length;n++)n>0&&(e+=","),e+=t[n]+":"+JSON.stringify(this.properties[t[n]]);e+="}"}return e+="]->("+this.end+")"}}]),e}();t.Relationship=u;var s=function(){function e(t,n,r){(0,i.default)(this,e),this.identity=t,this.type=n,this.properties=r}return(0,o.default)(e,[{key:"bind",value:function(e,t){return new u(this.identity,e,t,this.type,this.properties)}},{key:"toString",value:function(){var e="-[:"+this.type,t=Object.keys(this.properties);if(t.length>0){e+=" {";for(var n=0;n<t.length;n++)n>0&&(e+=","),e+=t[n]+":"+JSON.stringify(this.properties[t[n]]);e+="}"}return e+="]->"}}]),e}();t.UnboundRelationship=s;t.PathSegment=function e(t,n,r){(0,i.default)(this,e),this.start=t,this.relationship=n,this.end=r};t.Path=function e(t,n,r){(0,i.default)(this,e),this.start=t,this.end=n,this.segments=r,this.length=r.length}},function(e,t,n){"use strict";var r=n(7);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(9)),o=r(n(10)),a=r(n(23)),u=n(24),s=function(e){console.log("Uncaught error when processing result: "+e)},c=function(e){};var l=function(){function e(t,n,r,o,a){(0,i.default)(this,e),this._stack=function(){var e=new Error("");if(e.stack)return e.stack.replace(/^Error(\n\r)*/,"");return null}(),this._streamObserver=t,this._p=null,this._statement=n,this._parameters=r||{},this._metaSupplier=o||function(){return{}},this._connectionHolder=a||u.EMPTY_CONNECTION_HOLDER}return(0,o.default)(e,[{key:"_createPromise",value:function(){if(!this._p){var e=this;this._p=new Promise((function(t,n){var r=[],i={onNext:function(e){r.push(e)},onCompleted:function(e){t({records:r,summary:e})},onError:function(e){n(e)}};e.subscribe(i)}))}}},{key:"then",value:function(e,t){return this._createPromise(),this._p.then(e,t)}},{key:"catch",value:function(e){return this._createPromise(),this._p.catch(e)}},{key:"subscribe",value:function(e){var t=this,n=this,r=e.onCompleted||c;e.onCompleted=function(i){var o=n._metaSupplier();for(var u in o)o.hasOwnProperty(u)&&(i[u]=o[u]);var s=new a.default(t._statement,t._parameters,i);n._connectionHolder.releaseConnection().then((function(){r.call(e,s)}))};var i=e.onError||s;e.onError=function(r){n._connectionHolder.releaseConnection().then((function(){!function(e,t){t&&(e.stack=e.toString()+"\n"+t)}(r,t._stack),i.call(e,r)}))},this._streamObserver.subscribe(e)}}]),e}();t.default=l},function(e,t,n){"use strict";var r=n(7);Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.statementType=void 0;var i=r(n(9)),o=r(n(10)),a=n(8),u=function(){function e(t,n,r){(0,i.default)(this,e),this.statement={text:t,parameters:n},this.statementType=r.type,this.counters=new l(r.stats||{}),this.updateStatistics=this.counters,this.plan=!(!r.plan&&!r.profile)&&new s(r.plan||r.profile),this.profile=!!r.profile&&new c(r.profile),this.notifications=this._buildNotifications(r.notifications),this.server=new h(r.server),this.resultConsumedAfter=r.result_consumed_after,this.resultAvailableAfter=r.result_available_after}return(0,o.default)(e,[{key:"_buildNotifications",value:function(e){return e?e.map((function(e){return new f(e)})):[]}},{key:"hasPlan",value:function(){return this.plan instanceof s}},{key:"hasProfile",value:function(){return this.profile instanceof c}}]),e}(),s=function e(t){(0,i.default)(this,e),this.operatorType=t.operatorType,this.identifiers=t.identifiers,this.arguments=t.args,this.children=t.children?t.children.map((function(t){return new e(t)})):[]},c=function e(t){(0,i.default)(this,e),this.operatorType=t.operatorType,this.identifiers=t.identifiers,this.arguments=t.args,this.dbHits=d(t.args.DbHits),this.rows=d(t.args.Rows),this.children=t.children?t.children.map((function(t){return new e(t)})):[]},l=function(){function e(t){var n=this;(0,i.default)(this,e),this._stats={nodesCreated:0,nodesDeleted:0,relationshipsCreated:0,relationshipsDeleted:0,propertiesSet:0,labelsAdded:0,labelsRemoved:0,indexesAdded:0,indexesRemoved:0,constraintsAdded:0,constraintsRemoved:0},Object.keys(t).forEach((function(e){n._stats[e.replace(/(-\w)/g,(function(e){return e[1].toUpperCase()}))]=d(t[e])}))}return(0,o.default)(e,[{key:"containsUpdates",value:function(){var e=this;return Object.keys(this._stats).reduce((function(t,n){return t+e._stats[n]}),0)>0}},{key:"nodesCreated",value:function(){return this._stats.nodesCreated}},{key:"nodesDeleted",value:function(){return this._stats.nodesDeleted}},{key:"relationshipsCreated",value:function(){return this._stats.relationshipsCreated}},{key:"relationshipsDeleted",value:function(){return this._stats.relationshipsDeleted}},{key:"propertiesSet",value:function(){return this._stats.propertiesSet}},{key:"labelsAdded",value:function(){return this._stats.labelsAdded}},{key:"labelsRemoved",value:function(){return this._stats.labelsRemoved}},{key:"indexesAdded",value:function(){return this._stats.indexesAdded}},{key:"indexesRemoved",value:function(){return this._stats.indexesRemoved}},{key:"constraintsAdded",value:function(){return this._stats.constraintsAdded}},{key:"constraintsRemoved",value:function(){return this._stats.constraintsRemoved}}]),e}(),f=function(){function e(t){(0,i.default)(this,e),this.code=t.code,this.title=t.title,this.description=t.description,this.severity=t.severity,this.position=e._constructPosition(t.position)}return(0,o.default)(e,null,[{key:"_constructPosition",value:function(e){return e?{offset:d(e.offset),line:d(e.line),column:d(e.column)}:{}}}]),e}(),h=function e(t){(0,i.default)(this,e),t&&(this.address=t.address,this.version=t.version)};function d(e){return(0,a.isInt)(e)?e.toInt():e}t.statementType={READ_ONLY:"r",READ_WRITE:"rw",WRITE_ONLY:"w",SCHEMA_WRITE:"s"};var v=u;t.default=v},function(e,t,n){"use strict";var r=n(7);Object.defineProperty(t,"__esModule",{value:!0}),t.EMPTY_CONNECTION_HOLDER=t.default=void 0;var i=r(n(12)),o=r(n(15)),a=r(n(16)),u=r(n(9)),s=r(n(10)),c=n(11),l=function(){function e(t,n){(0,u.default)(this,e),this._mode=t,this._connectionProvider=n,this._referenceCount=0,this._connectionPromise=Promise.resolve(null)}return(0,s.default)(e,[{key:"mode",value:function(){return this._mode}},{key:"initializeConnection",value:function(){0===this._referenceCount&&(this._connectionPromise=this._connectionProvider.acquireConnection(this._mode)),this._referenceCount++}},{key:"getConnection",value:function(e){return this._connectionPromise.then((function(t){return e.resolveConnection(t),t}))}},{key:"releaseConnection",value:function(){return 0===this._referenceCount?this._connectionPromise:(this._referenceCount--,0===this._referenceCount?this._releaseConnection():this._connectionPromise)}},{key:"close",value:function(){return 0===this._referenceCount?this._connectionPromise:(this._referenceCount=0,this._releaseConnection())}},{key:"_releaseConnection",value:function(){return this._connectionPromise=this._connectionPromise.then((function(e){return e?e.resetAndFlush().catch(f).then((function(){return e._release()})):Promise.resolve()})).catch(f),this._connectionPromise}}]),e}();function f(){}t.default=l;var h=new(function(e){function t(){return(0,u.default)(this,t),(0,i.default)(this,(0,o.default)(t).apply(this,arguments))}return(0,a.default)(t,e),(0,s.default)(t,[{key:"initializeConnection",value:function(){}},{key:"getConnection",value:function(e){return Promise.reject((0,c.newError)("This connection holder does not serve connections"))}},{key:"releaseConnection",value:function(){return Promise.resolve()}},{key:"close",value:function(){return Promise.resolve()}}]),t}(l));t.EMPTY_CONNECTION_HOLDER=h},function(e,t,n){"use strict";var r=n(7);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(9)),o=r(n(10)),a=n(11);var u=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;(0,i.default)(this,e),this.keys=t,this.length=t.length,this._fields=n,this._fieldLookup=r||function(e){var t={};return e.forEach((function(e,n){t[e]=n})),t}(t)}return(0,o.default)(e,[{key:"forEach",value:function(e){for(var t=0;t<this.keys.length;t++)e(this._fields[t],this.keys[t],this)}},{key:"toObject",value:function(){var e={};return this.forEach((function(t,n){e[n]=t})),e}},{key:"get",value:function(e){var t;if("number"!=typeof e){if(void 0===(t=this._fieldLookup[e]))throw(0,a.newError)("This record has no field with key '"+e+"', available key are: ["+this.keys+"].")}else t=e;if(t>this._fields.length-1||t<0)throw(0,a.newError)("This record has no field with index '"+t+"'. Remember that indexes start at `0`, and make sure your statement returns records in the shape you meant it to.");return this._fields[t]}},{key:"has",value:function(e){return"number"==typeof e?e>=0&&e<this._fields.length:void 0!==this._fieldLookup[e]}}]),e}();t.default=u},function(e,t,n){"use strict";var r=n(4),i=n(7);Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.WRITE=t.READ=t.Driver=void 0;var o=i(n(9)),a=i(n(10)),u=i(n(27)),s=i(n(38)),c=i(n(41)),l=n(11),f=n(68),h=i(n(33)),d=i(n(79)),v=r(n(39)),_=i(n(40)),p=i(n(80)),y=n(36),g=36e5,m=y.ACCESS_MODE_READ;t.READ=m;var b=y.ACCESS_MODE_WRITE;t.WRITE=b;var k=0,w=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};(0,o.default)(this,e),function(e){e.maxConnectionLifetime=E(e.maxConnectionLifetime,g),e.maxConnectionPoolSize=E(e.maxConnectionPoolSize,v.DEFAULT_MAX_SIZE),e.connectionAcquisitionTimeout=E(e.connectionAcquisitionTimeout,v.DEFAULT_ACQUISITION_TIMEOUT)}(i),this._id=k++,this._address=t,this._userAgent=n,this._openConnections={},this._authToken=r,this._config=i,this._log=_.default.create(i),this._pool=new s.default({create:this._createConnection.bind(this),destroy:this._destroyConnection.bind(this),validate:this._validateConnection.bind(this),installIdleObserver:this._installIdleObserverOnConnection.bind(this),removeIdleObserver:this._removeIdleObserverOnConnection.bind(this),config:v.default.fromDriverConfig(i),log:this._log}),this._connectionProvider=null,this._onCompleted=null,this._afterConstruction()}return(0,a.default)(e,[{key:"_afterConstruction",value:function(){this._log.info("Direct driver ".concat(this._id," created for server address ").concat(this._address))}},{key:"_createConnection",value:function(e,t){var n=this,r=c.default.create(e,this._config,this._createConnectionErrorHandler(),this._log);return r._release=function(){return t(e,r)},this._openConnections[r.id]=r,r.connect(this._userAgent,this._authToken).catch((function(e){throw n.onError&&n.onError(e),n._destroyConnection(r),e}))}},{key:"_validateConnection",value:function(e){if(!e.isOpen())return!1;var t=this._config.maxConnectionLifetime;return Date.now()-e.creationTimestamp<=t}},{key:"_installIdleObserverOnConnection",value:function(e,t){e._queueObserver(t)}},{key:"_removeIdleObserverOnConnection",value:function(e){e._updateCurrentObserver()}},{key:"_destroyConnection",value:function(e){delete this._openConnections[e.id],e.close()}},{key:"session",value:function(t,n){var r=e._validateSessionMode(t),i=this._getOrCreateConnectionProvider(),o=n?new h.default(n):h.default.empty();return new u.default(r,i,o,this._config)}},{key:"_createConnectionProvider",value:function(e,t,n){return new f.DirectConnectionProvider(e,t,n)}},{key:"_createConnectionErrorHandler",value:function(){return new p.default(l.SERVICE_UNAVAILABLE)}},{key:"_getOrCreateConnectionProvider",value:function(){if(!this._connectionProvider){var e=this._driverOnErrorCallback.bind(this);this._connectionProvider=this._createConnectionProvider(this._address,this._pool,e)}return this._connectionProvider}},{key:"_driverOnErrorCallback",value:function(e){var t=this.onError;t&&e.code===l.SERVICE_UNAVAILABLE&&t(e)}},{key:"close",value:function(){this._log.info("Driver ".concat(this._id," closing"));try{this._pool.purgeAll()}finally{for(var e in this._openConnections)this._openConnections.hasOwnProperty(e)&&this._openConnections[e].close()}}},{key:"onCompleted",get:function(){return this._onCompleted},set:function(e){if(this._onCompleted=e,this._onCompleted){var t=this._getOrCreateConnectionProvider();new d.default(t,this._onCompleted).verify()}}}],[{key:"_validateSessionMode",value:function(e){var t=e||b;if(t!==y.ACCESS_MODE_READ&&t!==y.ACCESS_MODE_WRITE)throw(0,l.newError)("Illegal session mode "+t);return t}}]),e}();function E(e,t){var n=parseInt(e,10);return n>0||0===n?n:n<0?Number.MAX_SAFE_INTEGER:t}t.Driver=w;var I=w;t.default=I},function(e,t,n){"use strict";var r=n(7);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(12)),o=r(n(15)),a=r(n(28)),u=r(n(16)),s=r(n(9)),c=r(n(10)),l=r(n(30)),f=r(n(22)),h=r(n(31)),d=n(11),v=n(32),_=r(n(24)),p=r(n(26)),y=n(36),g=r(n(37)),m=r(n(33)),b=r(n(35)),k=function(){function e(t,n,r,i){(0,s.default)(this,e),this._mode=t,this._readConnectionHolder=new _.default(y.ACCESS_MODE_READ,n),this._writeConnectionHolder=new _.default(y.ACCESS_MODE_WRITE,n),this._open=!0,this._hasTx=!1,this._lastBookmark=r,this._transactionExecutor=function(e){var t=e&&e.maxTransactionRetryTime?e.maxTransactionRetryTime:null;return new g.default(t)}(i)}return(0,c.default)(e,[{key:"run",value:function(e,t,n){var r=this,i=(0,v.validateStatementAndParameters)(e,t),o=i.query,a=i.params,u=n?new b.default(n):b.default.empty();return this._run(o,a,(function(e,t){return e.protocol().run(o,a,r._lastBookmark,u,r._mode,t)}))}},{key:"_run",value:function(e,t,n){var r=new w(this),i=this._connectionHolderWithMode(this._mode);return this._hasTx?r.onError((0,d.newError)("Statements cannot be run directly on a session with an open transaction; either run from within the transaction or use a different session.")):(i.initializeConnection(),i.getConnection(r).then((function(e){return n(e,r)})).catch((function(e){return r.onError(e)}))),new f.default(r,e,t,(function(){return r.serverMetadata()}),i)}},{key:"beginTransaction",value:function(e){var t=e,n=b.default.empty();return"string"==typeof t||t instanceof String||Array.isArray(t)?this._updateBookmark(new m.default(t)):t&&(n=new b.default(t)),this._beginTransaction(this._mode,n)}},{key:"_beginTransaction",value:function(e,t){if(this._hasTx)throw(0,d.newError)("You cannot begin a transaction on a session with an open transaction; either run from within the transaction or use a different session.");var n=p.default._validateSessionMode(e),r=this._connectionHolderWithMode(n);r.initializeConnection(),this._hasTx=!0;var i=new h.default(r,this._transactionClosed.bind(this),this._updateBookmark.bind(this));return i._begin(this._lastBookmark,t),i}},{key:"_transactionClosed",value:function(){this._hasTx=!1}},{key:"lastBookmark",value:function(){return this._lastBookmark.maxBookmarkAsString()}},{key:"readTransaction",value:function(e,t){var n=new b.default(t);return this._runTransaction(y.ACCESS_MODE_READ,n,e)}},{key:"writeTransaction",value:function(e,t){var n=new b.default(t);return this._runTransaction(y.ACCESS_MODE_WRITE,n,e)}},{key:"_runTransaction",value:function(e,t,n){var r=this;return this._transactionExecutor.execute((function(){return r._beginTransaction(e,t)}),n)}},{key:"_updateBookmark",value:function(e){e&&!e.isEmpty()&&(this._lastBookmark=e)}},{key:"close",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){return null};this._open?(this._open=!1,this._transactionExecutor.close(),this._readConnectionHolder.close().then((function(){e._writeConnectionHolder.close().then((function(){t()}))}))):t()}},{key:"_connectionHolderWithMode",value:function(e){if(e===y.ACCESS_MODE_READ)return this._readConnectionHolder;if(e===y.ACCESS_MODE_WRITE)return this._writeConnectionHolder;throw(0,d.newError)("Unknown access mode: "+e)}}]),e}(),w=function(e){function t(e){var n;return(0,s.default)(this,t),(n=(0,i.default)(this,(0,o.default)(t).call(this)))._session=e,n}return(0,u.default)(t,e),(0,c.default)(t,[{key:"onCompleted",value:function(e){(0,a.default)((0,o.default)(t.prototype),"onCompleted",this).call(this,e);var n=new m.default(e.bookmark);this._session._updateBookmark(n)}}]),t}(l.default);var E=k;t.default=E},function(e,t,n){var r=n(29);function i(t,n,o){return"undefined"!=typeof Reflect&&Reflect.get?e.exports=i=Reflect.get:e.exports=i=function(e,t,n){var i=r(e,t);if(i){var o=Object.getOwnPropertyDescriptor(i,t);return o.get?o.get.call(n):o.value}},i(t,n,o||t)}e.exports=i},function(e,t,n){var r=n(15);e.exports=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=r(e)););return e}},function(e,t,n){"use strict";var r=n(7);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(9)),o=r(n(10)),a=r(n(25)),u=function(){function e(){(0,i.default)(this,e),this._fieldKeys=null,this._fieldLookup=null,this._queuedRecords=[],this._tail=null,this._error=null,this._hasFailed=!1,this._observer=null,this._conn=null,this._meta={}}return(0,o.default)(e,[{key:"onNext",value:function(e){var t=new a.default(this._fieldKeys,e,this._fieldLookup);this._observer?this._observer.onNext(t):this._queuedRecords.push(t)}},{key:"onCompleted",value:function(e){if(null===this._fieldKeys){if(this._fieldKeys=[],this._fieldLookup={},e.fields&&e.fields.length>0){this._fieldKeys=e.fields;for(var t=0;t<e.fields.length;t++)this._fieldLookup[e.fields[t]]=t}}else this._observer?this._observer.onCompleted(e):this._tail=e;this._copyMetadataOnCompletion(e)}},{key:"_copyMetadataOnCompletion",value:function(e){for(var t in e)e.hasOwnProperty(t)&&(this._meta[t]=e[t])}},{key:"serverMetadata",value:function(){var e={server:this._conn.server};return Object.assign({},this._meta,e)}},{key:"resolveConnection",value:function(e){this._conn=e}},{key:"prepareToHandleSingleResponse",value:function(){this._fieldKeys=[]}},{key:"markCompleted",value:function(){this._fieldKeys=[],this._tail={}}},{key:"onError",value:function(e){this._hasFailed||(this._hasFailed=!0,this._observer?this._observer.onError?this._observer.onError(e):console.log(e):this._error=e)}},{key:"subscribe",value:function(e){if(this._error)e.onError(this._error);else{if(this._queuedRecords.length>0)for(var t=0;t<this._queuedRecords.length;t++)e.onNext(this._queuedRecords[t]);this._tail&&e.onCompleted(this._tail),this._observer=e}}},{key:"hasFailed",value:function(){return this._hasFailed}}]),e}();t.default=u},function(e,t,n){"use strict";var r=n(7);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(12)),o=r(n(15)),a=r(n(28)),u=r(n(16)),s=r(n(9)),c=r(n(10)),l=r(n(30)),f=r(n(22)),h=n(32),d=n(24),v=r(n(33)),_=r(n(35)),p=function(){function e(t,n,r){(0,s.default)(this,e),this._connectionHolder=t,this._state=g.ACTIVE,this._onClose=n,this._onBookmark=r}return(0,c.default)(e,[{key:"_begin",value:function(e,t){var n=this,r=new y(this);this._connectionHolder.getConnection(r).then((function(i){return i.protocol().beginTransaction(e,t,n._connectionHolder.mode(),r)})).catch((function(e){return r.onError(e)}))}},{key:"run",value:function(e,t){var n=(0,h.validateStatementAndParameters)(e,t),r=n.query,i=n.params;return this._state.run(this._connectionHolder,new y(this),r,i)}},{key:"commit",value:function(){var e=this._state.commit(this._connectionHolder,new y(this));return this._state=e.state,this._onClose(),e.result}},{key:"rollback",value:function(){var e=this._state.rollback(this._connectionHolder,new y(this));return this._state=e.state,this._onClose(),e.result}},{key:"isOpen",value:function(){return this._state===g.ACTIVE}},{key:"_onError",value:function(){return this._state=g.FAILED,this._onClose(),this._connectionHolder.releaseConnection()}}]),e}(),y=function(e){function t(e){var n;return(0,s.default)(this,t),(n=(0,i.default)(this,(0,o.default)(t).call(this)))._tx=e,n}return(0,u.default)(t,e),(0,c.default)(t,[{key:"onError",value:function(e){var n=this;this._hasFailed||this._tx._onError().then((function(){(0,a.default)((0,o.default)(t.prototype),"onError",n).call(n,e)}))}},{key:"onCompleted",value:function(e){(0,a.default)((0,o.default)(t.prototype),"onCompleted",this).call(this,e);var n=new v.default(e.bookmark);this._tx._onBookmark(n)}}]),t}(l.default),g={ACTIVE:{commit:function(e,t){return{result:m(!0,e,t),state:g.SUCCEEDED}},rollback:function(e,t){return{result:m(!1,e,t),state:g.ROLLED_BACK}},run:function(e,t,n,r){var i=v.default.empty(),o=_.default.empty();return e.getConnection(t).then((function(a){return a.protocol().run(n,r,i,o,e.mode(),t)})).catch((function(e){return t.onError(e)})),function(e,t,n,r){return new f.default(e,t,n,r,d.EMPTY_CONNECTION_HOLDER)}(t,n,r,(function(){return t.serverMetadata()}))}},FAILED:{commit:function(e,t){return t.onError({error:"Cannot commit statements in this transaction, because previous statements in the transaction has failed and the transaction has been rolled back. Please start a new transaction to run another statement."}),{result:b(t,"COMMIT",{}),state:g.FAILED}},rollback:function(e,t){return t.markCompleted(),{result:b(t,"ROLLBACK",{}),state:g.FAILED}},run:function(e,t,n,r){return t.onError({error:"Cannot run statement, because previous statements in the transaction has failed and the transaction has already been rolled back."}),b(t,n,r)}},SUCCEEDED:{commit:function(e,t){return t.onError({error:"Cannot commit statements in this transaction, because commit has already been successfully called on the transaction and transaction has been closed. Please start a new transaction to run another statement."}),{result:b(t,"COMMIT",{}),state:g.SUCCEEDED}},rollback:function(e,t){return t.onError({error:"Cannot rollback transaction, because transaction has already been successfully closed."}),{result:b(t,"ROLLBACK",{}),state:g.SUCCEEDED}},run:function(e,t,n,r){return t.onError({error:"Cannot run statement, because transaction has already been successfully closed."}),b(t,n,r)}},ROLLED_BACK:{commit:function(e,t){return t.onError({error:"Cannot commit this transaction, because it has already been rolled back."}),{result:b(t,"COMMIT",{}),state:g.ROLLED_BACK}},rollback:function(e,t){return t.onError({error:"Cannot rollback transaction, because transaction has already been rolled back."}),{result:b(t,"ROLLBACK",{}),state:g.ROLLED_BACK}},run:function(e,t,n,r){return t.onError({error:"Cannot run statement, because transaction has already been rolled back."}),b(t,n,r)}}};function m(e,t,n){return t.getConnection(n).then((function(t){return e?t.protocol().commitTransaction(n):t.protocol().rollbackTransaction(n)})).catch((function(e){return n.onError(e)})),new f.default(n,e?"COMMIT":"ROLLBACK",{},k,t)}function b(e,t,n){return new f.default(e,t,n,k,d.EMPTY_CONNECTION_HOLDER)}function k(){return{}}var w=p;t.default=w},function(e,t,n){"use strict";var r=n(7);Object.defineProperty(t,"__esModule",{value:!0}),t.isEmptyObjectOrNull=function(e){if(null===e)return!0;if(!a(e))return!1;for(var t in e)if(e.hasOwnProperty(t))return!1;return!0},t.isObject=a,t.isString=s,t.assertObject=function(e,t){if(!a(e))throw new TypeError(t+" expected to be an object but was: "+JSON.stringify(e));return e},t.assertString=u,t.assertNumber=function(e,t){if("number"!=typeof e)throw new TypeError(t+" expected to be a number but was: "+JSON.stringify(e));return e},t.assertNumberOrInteger=function(e,t){if("number"!=typeof e&&!(0,o.isInt)(e))throw new TypeError(t+" expected to be either a number or an Integer object but was: "+JSON.stringify(e));return e},t.assertValidDate=function(e,t){if("[object Date]"!==Object.prototype.toString.call(e))throw new TypeError(t+" expected to be a standard JavaScript Date but was: "+JSON.stringify(e));if(Number.isNaN(e.getTime()))throw new TypeError(t+" expected to be valid JavaScript Date but its time was NaN: "+JSON.stringify(e));return e},t.validateStatementAndParameters=function(e,t){var n=e,r=t||{};"object"===(0,i.default)(e)&&e.text&&(n=e.text,r=e.parameters||{});return function(e){if(u(e,"Cypher statement"),0===e.trim().length)throw new TypeError("Cypher statement is expected to be a non-empty string.")}(n),function(e){if(!a(e)){var t=e.constructor?" "+e.constructor.name:"";throw new TypeError("Query parameters are expected to either be undefined/null or an object, given:".concat(t," ").concat(e))}}(r),{query:n,params:r}},t.ENCRYPTION_OFF=t.ENCRYPTION_ON=void 0;var i=r(n(13)),o=n(8);t.ENCRYPTION_ON="ENCRYPTION_ON";function a(e){return"object"===(0,i.default)(e)&&!Array.isArray(e)&&null!==e}function u(e,t){if(!s(e))throw new TypeError(t+" expected to be string but was: "+JSON.stringify(e));return e}function s(e){return"[object String]"===Object.prototype.toString.call(e)}t.ENCRYPTION_OFF="ENCRYPTION_OFF"},function(e,t,n){"use strict";var r=n(4),i=n(7);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=i(n(34)),a=i(n(9)),u=i(n(10)),s=r(n(32)),c="neo4j:bookmark:v1:tx",l=-1,f=function(){function e(t){(0,a.default)(this,e),this._values=function(e){if(!e)return[];if(s.isString(e))return[e];if(Array.isArray(e)){for(var t=[],n=0;n<e.length;n++){var r=e[n];if(null!=r){if(!s.isString(r))throw new TypeError("Bookmark should be a string, given: '".concat(r,"'"));t.push(r)}}return t}throw new TypeError("Bookmark should either be a string or a string array, given: '".concat(e,"'"))}(t),this._maxValue=function(e){if(!e||0===e.length)return null;for(var t=e[0],n=d(t),r=1;r<e.length;r++){var i=e[r],o=d(i);o>n&&(t=i,n=o)}return t}(this._values)}return(0,u.default)(e,[{key:"isEmpty",value:function(){return null===this._maxValue}},{key:"maxBookmarkAsString",value:function(){return this._maxValue}},{key:"values",value:function(){return this._values}},{key:"asBeginTransactionParameters",value:function(){var e;return this.isEmpty()?{}:(e={},(0,o.default)(e,"bookmark",this._maxValue),(0,o.default)(e,"bookmarks",this._values),e)}}],[{key:"empty",value:function(){return h}}]),e}();t.default=f;var h=new f(null);function d(e){return e&&0===e.indexOf(c)&&parseInt(e.substring(c.length))||l}},function(e,t){e.exports=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}},function(e,t,n){"use strict";var r=n(4),i=n(7);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=i(n(9)),a=i(n(10)),u=r(n(32)),s=n(8),c=n(11),l=function(){function e(t){(0,o.default)(this,e),function(e){e&&u.assertObject(e,"Transaction config")}(t),this.timeout=function(e){if(u.isObject(e)&&(e.timeout||0===e.timeout)){u.assertNumberOrInteger(e.timeout,"Transaction timeout");var t=(0,s.int)(e.timeout);if(t.isZero())throw(0,c.newError)("Transaction timeout should not be zero");if(t.isNegative())throw(0,c.newError)("Transaction timeout should not be negative");return t}return null}(t),this.metadata=function(e){if(u.isObject(e)&&e.metadata){var t=e.metadata;if(u.assertObject(t),0!==Object.keys(t).length)return t}return null}(t)}return(0,a.default)(e,[{key:"isEmpty",value:function(){return Object.values(this).every((function(e){return null==e}))}}],[{key:"empty",value:function(){return f}}]),e}();t.default=l;var f=new l({})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ACCESS_MODE_WRITE=t.ACCESS_MODE_READ=void 0;t.ACCESS_MODE_READ="READ";t.ACCESS_MODE_WRITE="WRITE"},function(e,t,n){"use strict";var r=n(7);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(9)),o=r(n(10)),a=n(11),u=3e4,s=1e3,c=2,l=.2,f=function(){function e(t,n,r,o){(0,i.default)(this,e),this._maxRetryTimeMs=h(t,u),this._initialRetryDelayMs=h(n,s),this._multiplier=h(r,c),this._jitterFactor=h(o,l),this._inFlightTimeoutIds=[],this._verifyAfterConstruction()}return(0,o.default)(e,[{key:"execute",value:function(e,t){var n=this;return new Promise((function(r,i){n._executeTransactionInsidePromise(e,t,r,i)})).catch((function(r){var i=Date.now(),o=n._initialRetryDelayMs;return n._retryTransactionPromise(e,t,r,i,o)}))}},{key:"close",value:function(){this._inFlightTimeoutIds.forEach((function(e){return clearTimeout(e)})),this._inFlightTimeoutIds=[]}},{key:"_retryTransactionPromise",value:function(t,n,r,i,o){var a=this;return Date.now()-i>this._maxRetryTimeMs||!e._canRetryOn(r)?Promise.reject(r):new Promise((function(e,r){var i=a._computeDelayWithJitter(o),u=setTimeout((function(){a._inFlightTimeoutIds=a._inFlightTimeoutIds.filter((function(e){return e!==u})),a._executeTransactionInsidePromise(t,n,e,r)}),i);a._inFlightTimeoutIds.push(u)})).catch((function(e){var r=o*a._multiplier;return a._retryTransactionPromise(t,n,e,i,r)}))}},{key:"_executeTransactionInsidePromise",value:function(e,t,n,r){var i,o=this;try{i=e()}catch(e){return void r(e)}this._safeExecuteTransactionWork(i,t).then((function(e){return o._handleTransactionWorkSuccess(e,i,n,r)})).catch((function(e){return o._handleTransactionWorkFailure(e,i,r)}))}},{key:"_safeExecuteTransactionWork",value:function(e,t){try{var n=t(e);return Promise.resolve(n)}catch(e){return Promise.reject(e)}}},{key:"_handleTransactionWorkSuccess",value:function(e,t,n,r){t.isOpen()?t.commit().then((function(){n(e)})).catch((function(e){r(e)})):n(e)}},{key:"_handleTransactionWorkFailure",value:function(e,t,n){t.isOpen()?t.rollback().catch((function(e){})).then((function(){return n(e)})):n(e)}},{key:"_computeDelayWithJitter",value:function(e){var t=e*this._jitterFactor,n=e-t,r=e+t;return Math.random()*(r-n)+n}},{key:"_verifyAfterConstruction",value:function(){if(this._maxRetryTimeMs<0)throw(0,a.newError)("Max retry time should be >= 0: "+this._maxRetryTimeMs);if(this._initialRetryDelayMs<0)throw(0,a.newError)("Initial retry delay should >= 0: "+this._initialRetryDelayMs);if(this._multiplier<1)throw(0,a.newError)("Multiplier should be >= 1.0: "+this._multiplier);if(this._jitterFactor<0||this._jitterFactor>1)throw(0,a.newError)("Jitter factor should be in [0.0, 1.0]: "+this._jitterFactor)}}],[{key:"_canRetryOn",value:function(e){return e&&e.code&&(e.code===a.SERVICE_UNAVAILABLE||e.code===a.SESSION_EXPIRED||this._isTransientError(e))}},{key:"_isTransientError",value:function(e){var t=e.code;return t.indexOf("TransientError")>=0&&("Neo.TransientError.Transaction.Terminated"!==t&&"Neo.TransientError.Transaction.LockClientStopped"!==t)}}]),e}();function h(e,t){return e||0===e?e:t}t.default=f},function(e,t,n){"use strict";var r=n(7);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(9)),o=r(n(10)),a=r(n(39)),u=n(11),s=r(n(40)),c=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.create,r=void 0===n?function(e,t){}:n,o=t.destroy,u=void 0===o?function(e){return!0}:o,c=t.validate,l=void 0===c?function(e){return!0}:c,f=t.installIdleObserver,h=void 0===f?function(e,t){}:f,d=t.removeIdleObserver,v=void 0===d?function(e){}:d,_=t.config,p=void 0===_?a.default.defaultConfig():_,y=t.log,g=void 0===y?s.default.noOp():y;(0,i.default)(this,e),this._create=r,this._destroy=u,this._validate=l,this._installIdleObserver=h,this._removeIdleObserver=v,this._maxSize=p.maxSize,this._acquisitionTimeout=p.acquisitionTimeout,this._pools={},this._acquireRequests={},this._activeResourceCounts={},this._release=this._release.bind(this),this._log=g}return(0,o.default)(e,[{key:"acquire",value:function(e){var t=this;return this._acquire(e).then((function(n){var r=e.asKey();if(n)return l(r,t._activeResourceCounts),t._log.isDebugEnabled()&&t._log.debug("".concat(n," acquired from the pool ").concat(r)),n;var i=t._acquireRequests;return i[r]||(i[r]=[]),new Promise((function(e,n){var o,a=setTimeout((function(){var e=i[r];e&&(i[r]=e.filter((function(e){return e!==o}))),o.isCompleted()||o.reject((0,u.newError)("Connection acquisition timed out in ".concat(t._acquisitionTimeout," ms.")))}),t._acquisitionTimeout);o=new f(r,e,n,a,t._log),i[r].push(o)}))}))}},{key:"purge",value:function(e){this._purgeKey(e.asKey())}},{key:"purgeAll",value:function(){var e=this;Object.keys(this._pools).forEach((function(t){return e._purgeKey(t)}))}},{key:"keepAll",value:function(e){var t=this,n=e.map((function(e){return e.asKey()}));Object.keys(this._pools).filter((function(e){return-1===n.indexOf(e)})).forEach((function(e){return t._purgeKey(e)}))}},{key:"has",value:function(e){return e.asKey()in this._pools}},{key:"activeResourceCount",value:function(e){return this._activeResourceCounts[e.asKey()]||0}},{key:"_acquire",value:function(e){var t=e.asKey(),n=this._pools[t];for(n||(n=[],this._pools[t]=n);n.length;){var r=n.pop();if(this._validate(r))return this._removeIdleObserver&&this._removeIdleObserver(r),Promise.resolve(r);this._destroy(r)}return this._maxSize&&this.activeResourceCount(e)>=this._maxSize?Promise.resolve(null):this._create(e,this._release)}},{key:"_release",value:function(e,t){var n=this,r=e.asKey(),i=this._pools[r];i?this._validate(t)?(this._log.isDebugEnabled()&&this._log.debug("".concat(t," released to the pool ").concat(r)),this._installIdleObserver&&this._installIdleObserver(t,{onError:function(){var e=n._pools[r];e&&(n._pools[r]=e.filter((function(e){return e!==t}))),n._destroy(t)}}),i.push(t)):(this._log.isDebugEnabled()&&this._log.debug("".concat(t," destroyed and can't be released to the pool ").concat(r," because it is not functional")),this._destroy(t)):(this._log.isDebugEnabled()&&this._log.debug("".concat(t," destroyed and can't be released to the pool ").concat(r," because pool has been purged")),this._destroy(t)),function(e,t){var n=(t[e]||0)-1;n>0?t[e]=n:delete t[e]}(r,this._activeResourceCounts),this._processPendingAcquireRequests(e)}},{key:"_purgeKey",value:function(e){for(var t=this._pools[e]||[];t.length;){var n=t.pop();this._removeIdleObserver&&this._removeIdleObserver(n),this._destroy(n)}delete this._pools[e]}},{key:"_processPendingAcquireRequests",value:function(e){var t=this,n=e.asKey(),r=this._acquireRequests[n];if(r){var i=r.shift();i?this._acquire(e).catch((function(e){return i.reject(e),null})).then((function(r){r&&(i.isCompleted()?t._release(e,r):(l(n,t._activeResourceCounts),i.resolve(r)))})):delete this._acquireRequests[n]}}}]),e}();function l(e,t){var n=t[e]||0;t[e]=n+1}var f=function(){function e(t,n,r,o,a){(0,i.default)(this,e),this._key=t,this._resolve=n,this._reject=r,this._timeoutId=o,this._log=a,this._completed=!1}return(0,o.default)(e,[{key:"isCompleted",value:function(){return this._completed}},{key:"resolve",value:function(e){this._completed||(this._completed=!0,clearTimeout(this._timeoutId),this._log.isDebugEnabled()&&this._log.debug("".concat(e," acquired from the pool ").concat(this._key)),this._resolve(e))}},{key:"reject",value:function(e){this._completed||(this._completed=!0,clearTimeout(this._timeoutId),this._reject(e))}}]),e}(),h=c;t.default=h},function(e,t,n){"use strict";var r=n(7);Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_ACQUISITION_TIMEOUT=t.DEFAULT_MAX_SIZE=t.default=void 0;var i=r(n(9)),o=r(n(10)),a=100;t.DEFAULT_MAX_SIZE=a;var u=6e4;t.DEFAULT_ACQUISITION_TIMEOUT=u;var s=function(){function e(t,n){(0,i.default)(this,e),this.maxSize=c(t,a),this.acquisitionTimeout=c(n,u)}return(0,o.default)(e,null,[{key:"defaultConfig",value:function(){return new e(a,u)}},{key:"fromDriverConfig",value:function(t){var n,r=l(t.connectionPoolSize);return l(t.maxConnectionPoolSize)?n=t.maxConnectionPoolSize:r?(console.warn('WARNING: neo4j-driver setting "connectionPoolSize" is deprecated, please use "maxConnectionPoolSize" instead'),n=t.connectionPoolSize):n=a,new e(n,l(t.connectionAcquisitionTimeout)?t.connectionAcquisitionTimeout:u)}}]),e}();function c(e,t){return 0===e||e?e:t}function l(e){return 0===e||e}t.default=s},function(e,t,n){"use strict";var r=n(7);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i,o=r(n(12)),a=r(n(15)),u=r(n(16)),s=r(n(9)),c=r(n(10)),l=r(n(34)),f=n(11),h="info",d=(i={},(0,l.default)(i,"error",0),(0,l.default)(i,"warn",1),(0,l.default)(i,"info",2),(0,l.default)(i,"debug",3),i),v=function(){function e(t,n){(0,s.default)(this,e),this._level=t,this._loggerFunction=n}return(0,c.default)(e,[{key:"isErrorEnabled",value:function(){return p(this._level,"error")}},{key:"error",value:function(e){this.isErrorEnabled()&&this._loggerFunction("error",e)}},{key:"isWarnEnabled",value:function(){return p(this._level,"warn")}},{key:"warn",value:function(e){this.isWarnEnabled()&&this._loggerFunction("warn",e)}},{key:"isInfoEnabled",value:function(){return p(this._level,"info")}},{key:"info",value:function(e){this.isInfoEnabled()&&this._loggerFunction("info",e)}},{key:"isDebugEnabled",value:function(){return p(this._level,"debug")}},{key:"debug",value:function(e){this.isDebugEnabled()&&this._loggerFunction("debug",e)}}],[{key:"create",value:function(t){if(t&&t.logging){var n=t.logging;return new e(function(e){if(e&&e.level){var t=e.level,n=d[t];if(!n&&0!==n)throw(0,f.newError)("Illegal logging level: ".concat(t,". Supported levels are: ").concat(Object.keys(d)));return t}return h}(n),function(e){if(e&&e.logger){var t=e.logger;if(t&&"function"==typeof t)return t}throw(0,f.newError)("Illegal logger function: ".concat(e.logger))}(n))}return this.noOp()}},{key:"noOp",value:function(){return _}}]),e}(),_=new(function(e){function t(){return(0,s.default)(this,t),(0,o.default)(this,(0,a.default)(t).call(this,null,null))}return(0,u.default)(t,e),(0,c.default)(t,[{key:"isErrorEnabled",value:function(){return!1}},{key:"error",value:function(e){}},{key:"isWarnEnabled",value:function(){return!1}},{key:"warn",value:function(e){}},{key:"isInfoEnabled",value:function(){return!1}},{key:"info",value:function(e){}},{key:"isDebugEnabled",value:function(){return!1}},{key:"debug",value:function(e){}}]),t}(v));function p(e,t){return d[e]>=d[t]}var y=v;t.default=y},function(e,t,n){"use strict";var r=n(7);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(9)),o=r(n(10)),a=n(42),u=n(50),s=n(11),c=r(n(52)),l=n(53),f=r(n(54));function h(){}var d={onNext:h,onCompleted:h,onError:h},v=0,_=function(){function e(t,n,r,o){var a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];(0,i.default)(this,e),this.id=v++,this.address=r,this.server={address:r.asHostPort()},this.creationTimestamp=Date.now(),this._errorHandler=n,this._disableLosslessIntegers=a,this._pendingObservers=[],this._currentObserver=void 0,this._ch=t,this._dechunker=new u.Dechunker,this._chunker=new u.Chunker(t),this._log=o,this._dbConnectionId=null,this._protocol=null,this._currentFailure=null,this._isBroken=!1,this._log.isDebugEnabled()&&this._log.debug("".concat(this," created towards ").concat(r))}return(0,o.default)(e,[{key:"connect",value:function(e,t){var n=this;return this._negotiateProtocol().then((function(){return n._initialize(e,t)}))}},{key:"_negotiateProtocol",value:function(){var e=this,t=new f.default(this,this._ch,this._chunker,this._disableLosslessIntegers,this._log);return new Promise((function(n,r){var i=function(t){e._handleFatalError(t),r(t)};e._ch.onerror=i.bind(e),e._ch._error&&i(e._ch._error),e._ch.onmessage=function(i){try{e._protocol=t.createNegotiatedProtocol(i),e._ch.onerror=e._handleFatalError.bind(e),e._ch.onmessage=function(t){return e._dechunker.write(t)},e._dechunker.onmessage=function(t){e._handleMessage(e._protocol.unpacker().unpack(t))},i.hasRemaining()&&e._dechunker.write(i.readSlice(i.remaining())),n(e)}catch(t){e._handleFatalError(t),r(t)}},t.writeHandshakeRequest()}))}},{key:"_initialize",value:function(e,t){var n=this;return new Promise((function(r,i){var o=new p(n,r,i);n._protocol.initialize(e,t,o)}))}},{key:"protocol",value:function(){return this._protocol}},{key:"write",value:function(e,t,n){var r=this;this._queueObserver(t)&&(this._log.isDebugEnabled()&&this._log.debug("".concat(this," C: ").concat(e)),this._protocol.packer().packStruct(e.signature,e.fields.map((function(e){return r._packable(e)})),(function(e){return r._handleFatalError(e)})),this._chunker.messageBoundary(),n&&this._chunker.flush())}},{key:"_handleFatalError",value:function(e){for(this._isBroken=!0,this._error=this._errorHandler.handleAndTransformError(e,this.address),this._log.isErrorEnabled()&&this._log.error("".concat(this," experienced a fatal error ").concat(JSON.stringify(this._error))),this._currentObserver&&this._currentObserver.onError&&this._currentObserver.onError(this._error);this._pendingObservers.length>0;){var t=this._pendingObservers.shift();t&&t.onError&&t.onError(this._error)}}},{key:"_handleMessage",value:function(e){if(!this._isBroken){var t=e.fields[0];switch(e.signature){case 113:this._log.isDebugEnabled()&&this._log.debug("".concat(this," S: RECORD ").concat(JSON.stringify(e))),this._currentObserver.onNext(t);break;case 112:this._log.isDebugEnabled()&&this._log.debug("".concat(this," S: SUCCESS ").concat(JSON.stringify(e)));try{var n=this._protocol.transformMetadata(t);this._currentObserver.onCompleted(n)}finally{this._updateCurrentObserver()}break;case 127:this._log.isDebugEnabled()&&this._log.debug("".concat(this," S: FAILURE ").concat(JSON.stringify(e)));try{var r=(0,s.newError)(t.message,t.code);this._currentFailure=this._errorHandler.handleAndTransformError(r,this.address),this._currentObserver.onError(this._currentFailure)}finally{this._updateCurrentObserver(),this._resetOnFailure()}break;case 126:this._log.isDebugEnabled()&&this._log.debug("".concat(this," S: IGNORED ").concat(JSON.stringify(e)));try{this._currentFailure&&this._currentObserver.onError?this._currentObserver.onError(this._currentFailure):this._currentObserver.onError&&this._currentObserver.onError((0,s.newError)("Ignored either because of an error or RESET"))}finally{this._updateCurrentObserver()}break;default:this._handleFatalError((0,s.newError)("Unknown Bolt protocol message: "+e))}}}},{key:"resetAndFlush",value:function(){var e=this;return new Promise((function(t,n){e._protocol.reset({onNext:function(t){var r=e._handleProtocolError("Received RECORD as a response for RESET: "+JSON.stringify(t));n(r)},onError:function(t){if(e._isBroken)n(t);else{var r=e._handleProtocolError("Received FAILURE as a response for RESET: "+t);n(r)}},onCompleted:function(){t()}})}))}},{key:"_resetOnFailure",value:function(){var e=this;this._protocol.reset({onNext:function(t){e._handleProtocolError("Received RECORD as a response for RESET: "+JSON.stringify(t))},onError:function(){e._currentFailure=null},onCompleted:function(){e._currentFailure=null}})}},{key:"_queueObserver",value:function(e){return this._isBroken?(e&&e.onError&&e.onError(this._error),!1):((e=e||d).onCompleted=e.onCompleted||h,e.onError=e.onError||h,e.onNext=e.onNext||h,void 0===this._currentObserver?this._currentObserver=e:this._pendingObservers.push(e),!0)}},{key:"_updateCurrentObserver",value:function(){this._currentObserver=this._pendingObservers.shift()}},{key:"isOpen",value:function(){return!this._isBroken&&this._ch._open}},{key:"close",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){return null};this._log.isDebugEnabled()&&this._log.debug("".concat(this," closing")),this._protocol&&this.isOpen()&&this._protocol.prepareToClose(d),this._ch.close((function(){e._log.isDebugEnabled()&&e._log.debug("".concat(e," closed")),t()}))}},{key:"toString",value:function(){var e=this._dbConnectionId||"";return"Connection [".concat(this.id,"][").concat(e,"]")}},{key:"_packable",value:function(e){var t=this;return this._protocol.packer().packable(e,(function(e){return t._handleFatalError(e)}))}},{key:"_handleProtocolError",value:function(e){this._currentFailure=null,this._updateCurrentObserver();var t=(0,s.newError)(e,s.PROTOCOL_ERROR);return this._handleFatalError(t),t}}],[{key:"create",value:function(t,n,r,i){var o=new c.default(t,n,r.errorCode());return new e(new a.Channel(o),r,t,i,n.disableLosslessIntegers)}}]),e}();t.default=_;var p=function(){function e(t,n,r){(0,i.default)(this,e),this._connection=t,this._onSuccess=n,this._onError=r}return(0,o.default)(e,[{key:"onNext",value:function(e){this.onError((0,s.newError)("Received RECORD when initializing "+JSON.stringify(e)))}},{key:"onError",value:function(e){this._connection._updateCurrentObserver(),this._connection._handleFatalError(e),this._onError(e)}},{key:"onCompleted",value:function(e){if(e){var t=e.server;if(!this._connection.server.version)this._connection.server.version=t,l.ServerVersion.fromString(t).compareTo(l.VERSION_3_2_0)<0&&this._connection.protocol().packer().disableByteArrays();var n=e.connection_id;this._connection._dbConnectionId||(this._connection._dbConnectionId=n)}this._onSuccess(this._connection)}}]),e}()},function(e,t,n){"use strict";var r=n(7);Object.defineProperty(t,"__esModule",{value:!0}),t.utf8=t.HostNameResolver=t.Channel=t.alloc=void 0;var i=r(n(43)),o=r(n(45)),a=r(n(46)),u=r(n(48));t.alloc=function(e){return new i.default(e)};var s=o.default;t.Channel=s;var c=a.default;t.HostNameResolver=c;var l=u.default;t.utf8=l},function(e,t,n){"use strict";var r=n(7);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(9)),o=r(n(10)),a=r(n(12)),u=r(n(15)),s=r(n(16)),c=function(e){function t(e){var n;(0,i.default)(this,t);var r=e instanceof ArrayBuffer?e:new ArrayBuffer(e);return(n=(0,a.default)(this,(0,u.default)(t).call(this,r.byteLength)))._buffer=r,n._view=new DataView(n._buffer),n}return(0,s.default)(t,e),(0,o.default)(t,[{key:"putUInt8",value:function(e,t){this._view.setUint8(e,t)}},{key:"getUInt8",value:function(e){return this._view.getUint8(e)}},{key:"putInt8",value:function(e,t){this._view.setInt8(e,t)}},{key:"getInt8",value:function(e){return this._view.getInt8(e)}},{key:"getFloat64",value:function(e){return this._view.getFloat64(e)}},{key:"putFloat64",value:function(e,t){this._view.setFloat64(e,t)}},{key:"getSlice",value:function(e,n){if(this._buffer.slice)return new t(this._buffer.slice(e,e+n));for(var r=new t(n),i=0;i<n;i++)r.putUInt8(i,this.getUInt8(i+e));return r}},{key:"readView",value:function(e){return new DataView(this._buffer,this._updatePos(e),e)}}]),t}(r(n(44)).default);t.default=c},function(e,t,n){"use strict";var r=n(7);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(12)),o=r(n(15)),a=r(n(16)),u=r(n(9)),s=r(n(10)),c=function(){function e(t){(0,u.default)(this,e),this.position=0,this.length=t}return(0,s.default)(e,[{key:"getUInt8",value:function(e){throw new Error("Not implemented")}},{key:"getInt8",value:function(e){throw new Error("Not implemented")}},{key:"getFloat64",value:function(e){throw new Error("Not implemented")}},{key:"putUInt8",value:function(e,t){throw new Error("Not implemented")}},{key:"putInt8",value:function(e,t){throw new Error("Not implemented")}},{key:"putFloat64",value:function(e,t){throw new Error("Not implemented")}},{key:"getInt16",value:function(e){return this.getInt8(e)<<8|this.getUInt8(e+1)}},{key:"getUInt16",value:function(e){return this.getUInt8(e)<<8|this.getUInt8(e+1)}},{key:"getInt32",value:function(e){return this.getInt8(e)<<24|this.getUInt8(e+1)<<16|this.getUInt8(e+2)<<8|this.getUInt8(e+3)}},{key:"getUInt32",value:function(e){return this.getUInt8(e)<<24|this.getUInt8(e+1)<<16|this.getUInt8(e+2)<<8|this.getUInt8(e+3)}},{key:"getInt64",value:function(e){return this.getInt8(e)<<56|this.getUInt8(e+1)<<48|this.getUInt8(e+2)<<40|this.getUInt8(e+3)<<32|this.getUInt8(e+4)<<24|this.getUInt8(e+5)<<16|this.getUInt8(e+6)<<8|this.getUInt8(e+7)}},{key:"getSlice",value:function(e,t){return new l(e,t,this)}},{key:"putInt16",value:function(e,t){this.putInt8(e,t>>8),this.putUInt8(e+1,255&t)}},{key:"putUInt16",value:function(e,t){this.putUInt8(e,t>>8&255),this.putUInt8(e+1,255&t)}},{key:"putInt32",value:function(e,t){this.putInt8(e,t>>24),this.putUInt8(e+1,t>>16&255),this.putUInt8(e+2,t>>8&255),this.putUInt8(e+3,255&t)}},{key:"putUInt32",value:function(e,t){this.putUInt8(e,t>>24&255),this.putUInt8(e+1,t>>16&255),this.putUInt8(e+2,t>>8&255),this.putUInt8(e+3,255&t)}},{key:"putInt64",value:function(e,t){this.putInt8(e,t>>48),this.putUInt8(e+1,t>>42&255),this.putUInt8(e+2,t>>36&255),this.putUInt8(e+3,t>>30&255),this.putUInt8(e+4,t>>24&255),this.putUInt8(e+5,t>>16&255),this.putUInt8(e+6,t>>8&255),this.putUInt8(e+7,255&t)}},{key:"putBytes",value:function(e,t){for(var n=0,r=t.remaining();n<r;n++)this.putUInt8(e+n,t.readUInt8())}},{key:"readUInt8",value:function(){return this.getUInt8(this._updatePos(1))}},{key:"readInt8",value:function(){return this.getInt8(this._updatePos(1))}},{key:"readUInt16",value:function(){return this.getUInt16(this._updatePos(2))}},{key:"readUInt32",value:function(){return this.getUInt32(this._updatePos(4))}},{key:"readInt16",value:function(){return this.getInt16(this._updatePos(2))}},{key:"readInt32",value:function(){return this.getInt32(this._updatePos(4))}},{key:"readInt64",value:function(){return this.getInt32(this._updatePos(8))}},{key:"readFloat64",value:function(){return this.getFloat64(this._updatePos(8))}},{key:"writeUInt8",value:function(e){this.putUInt8(this._updatePos(1),e)}},{key:"writeInt8",value:function(e){this.putInt8(this._updatePos(1),e)}},{key:"writeInt16",value:function(e){this.putInt16(this._updatePos(2),e)}},{key:"writeInt32",value:function(e){this.putInt32(this._updatePos(4),e)}},{key:"writeUInt32",value:function(e){this.putUInt32(this._updatePos(4),e)}},{key:"writeInt64",value:function(e){this.putInt64(this._updatePos(8),e)}},{key:"writeFloat64",value:function(e){this.putFloat64(this._updatePos(8),e)}},{key:"writeBytes",value:function(e){this.putBytes(this._updatePos(e.remaining()),e)}},{key:"readSlice",value:function(e){return this.getSlice(this._updatePos(e),e)}},{key:"_updatePos",value:function(e){var t=this.position;return this.position+=e,t}},{key:"remaining",value:function(){return this.length-this.position}},{key:"hasRemaining",value:function(){return this.remaining()>0}},{key:"reset",value:function(){this.position=0}},{key:"toString",value:function(){return this.constructor.name+"( position="+this.position+" )\n  "+this.toHex()}},{key:"toHex",value:function(){for(var e="",t=0;t<this.length;t++){var n=this.getUInt8(t).toString(16);1===n.length&&(n="0"+n),e+=n,t!==this.length-1&&(e+=" ")}return e}}]),e}();t.default=c;var l=function(e){function t(e,n,r){var a;return(0,u.default)(this,t),(a=(0,i.default)(this,(0,o.default)(t).call(this,n)))._start=e,a._inner=r,a}return(0,a.default)(t,e),(0,s.default)(t,[{key:"putUInt8",value:function(e,t){this._inner.putUInt8(this._start+e,t)}},{key:"getUInt8",value:function(e){return this._inner.getUInt8(this._start+e)}},{key:"putInt8",value:function(e,t){this._inner.putInt8(this._start+e,t)}},{key:"putFloat64",value:function(e,t){this._inner.putFloat64(this._start+e,t)}},{key:"getInt8",value:function(e){return this._inner.getInt8(this._start+e)}},{key:"getFloat64",value:function(e){return this._inner.getFloat64(this._start+e)}}]),t}(c)},function(e,t,n){"use strict";var r=n(7);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(9)),o=r(n(10)),a=r(n(43)),u=n(11),s=n(32),c=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:l;(0,i.default)(this,e),this._open=!0,this._pending=[],this._error=null,this._handleConnectionError=this._handleConnectionError.bind(this),this._config=t;var r=function(e,t){var n=function(e){return!0===e.encrypted||e.encrypted===s.ENCRYPTION_ON}(e),r=function(e){return!1===e.encrypted||e.encrypted===s.ENCRYPTION_OFF}(e),i=e.trust,o=function(e){var t="function"==typeof e?e():"";return t&&t.toLowerCase().indexOf("https")>=0}(t);if(function(e,t,n){e&&!n?console.warn("Neo4j driver is configured to use secure WebSocket on a HTTP web page. WebSockets might not work in a mixed content environment. Please consider configuring driver to not use encryption."):t&&n&&console.warn("Neo4j driver is configured to use insecure WebSocket on a HTTPS web page. WebSockets might not work in a mixed content environment. Please consider configuring driver to use encryption.")}(n,r,o),r)return{scheme:"ws",error:null};if(o)return{scheme:"wss",error:null};if(n){return i&&"TRUST_CUSTOM_CA_SIGNED_CERTIFICATES"!==i?{scheme:null,error:(0,u.newError)("The browser version of this driver only supports one trust strategy, 'TRUST_CUSTOM_CA_SIGNED_CERTIFICATES'. "+i+' is not supported. Please either use TRUST_CUSTOM_CA_SIGNED_CERTIFICATES or disable encryption by setting `encrypted:"'+s.ENCRYPTION_OFF+'"` in the driver configuration.')}:{scheme:"wss",error:null}}return{scheme:"ws",error:null}}(t,n),o=r.scheme,c=r.error;if(c)this._error=c;else{this._ws=function(e,t){var n=e+"://"+t.asHostPort();try{return new WebSocket(n)}catch(n){if(function(e,t){return"SyntaxError"===e.name&&(n=t.asHostPort(),"["===n.charAt(0)&&-1!==n.indexOf("]"));var n}(n,t)){var r=function(e,t){var n=t.host().replace(new RegExp(":","g"),"-").replace("%","s")+".ipv6-literal.net";return"".concat(e,"://").concat(n,":").concat(t.port())}(e,t);return new WebSocket(r)}throw n}}(o,t.address),this._ws.binaryType="arraybuffer";var f=this;this._ws.onclose=function(e){e.wasClean||f._handleConnectionError()},this._ws.onopen=function(){f._clearConnectionTimeout();var e=f._pending;f._pending=null;for(var t=0;t<e.length;t++)f.write(e[t])},this._ws.onmessage=function(e){if(f.onmessage){var t=new a.default(e.data);f.onmessage(t)}},this._ws.onerror=this._handleConnectionError,this._connectionTimeoutFired=!1,this._connectionTimeoutId=this._setupConnectionTimeout()}}return(0,o.default)(e,[{key:"_handleConnectionError",value:function(){if(this._connectionTimeoutFired)return this._error=(0,u.newError)("Failed to establish connection in ".concat(this._config.connectionTimeout,"ms"),this._config.connectionErrorCode),void(this.onerror&&this.onerror(this._error));this._open&&(this._error=(0,u.newError)("WebSocket connection failure. Due to security constraints in your web browser, the reason for the failure is not available to this Neo4j Driver. Please use your browsers development console to determine the root cause of the failure. Common reasons include the database being unavailable, using the wrong connection URL or temporary network problems. If you have enabled encryption, ensure your browser is configured to trust the certificate Neo4j is configured to use. WebSocket `readyState` is: "+this._ws.readyState,this._config.connectionErrorCode),this.onerror&&this.onerror(this._error))}},{key:"write",value:function(e){if(null!==this._pending)this._pending.push(e);else{if(!(e instanceof a.default))throw(0,u.newError)("Don't know how to send buffer: "+e);this._ws.send(e._buffer)}}},{key:"close",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){return null};this._open=!1,this._clearConnectionTimeout(),this._ws.close(),this._ws.onclose=e}},{key:"_setupConnectionTimeout",value:function(){var e=this,t=this._config.connectionTimeout;if(t){var n=this._ws;return setTimeout((function(){n.readyState!==WebSocket.OPEN&&(e._connectionTimeoutFired=!0,n.close())}),t)}return null}},{key:"_clearConnectionTimeout",value:function(){var e=this._connectionTimeoutId;(e||0===e)&&(this._connectionTimeoutFired=!1,this._connectionTimeoutId=null,clearTimeout(e))}}]),e}();function l(){return"undefined"!=typeof window&&window.location?window.location.protocol:null}t.default=c},function(e,t,n){"use strict";var r=n(7);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(9)),o=r(n(10)),a=r(n(12)),u=r(n(15)),s=r(n(16)),c=function(e){function t(){return(0,i.default)(this,t),(0,a.default)(this,(0,u.default)(t).apply(this,arguments))}return(0,s.default)(t,e),(0,o.default)(t,[{key:"resolve",value:function(e){return this._resolveToItself(e)}}]),t}(r(n(47)).default);t.default=c},function(e,t,n){"use strict";var r=n(7);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(9)),o=r(n(10)),a=function(){function e(){(0,i.default)(this,e)}return(0,o.default)(e,[{key:"resolve",value:function(){throw new Error("Abstract function")}},{key:"_resolveToItself",value:function(e){return Promise.resolve([e])}}]),e}();t.default=a},function(e,t,n){"use strict";var r=n(7);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(43)),o=n(49),a=new o.TextEncoder("utf-8"),u=new o.TextDecoder("utf-8");var s={encode:function(e){return new i.default(a.encode(e).buffer)},decode:function(e,t){if(e instanceof i.default)return u.decode(e.readView(Math.min(t,e.length-e.position)));for(var n=new i.default(t),r=0;r<t;r++)n.writeUInt8(e.readUInt8());return n.reset(),u.decode(n.readView(t))}};t.default=s},function(e,t,n){"use strict";function r(e,t,n){return t<=e&&e<=n}function i(e){if(void 0===e)return{};if(e===Object(e))return e;throw TypeError("Could not convert argument to dictionary")}n.r(t),n.d(t,"TextEncoder",(function(){return f})),n.d(t,"TextDecoder",(function(){return l}));var o=-1;function a(e){this.tokens=[].slice.call(e)}a.prototype={endOfStream:function(){return!this.tokens.length},read:function(){return this.tokens.length?this.tokens.shift():o},prepend:function(e){if(Array.isArray(e))for(var t=e;t.length;)this.tokens.unshift(t.pop());else this.tokens.unshift(e)},push:function(e){if(Array.isArray(e))for(var t=e;t.length;)this.tokens.push(t.shift());else this.tokens.push(e)}};var u=-1;function s(e,t){if(e)throw TypeError("Decoder error");return t||65533}var c="utf-8";function l(e,t){if(!(this instanceof l))return new l(e,t);if((e=void 0!==e?String(e).toLowerCase():c)!==c)throw new Error("Encoding not supported. Only utf-8 is supported");t=i(t),this._streaming=!1,this._BOMseen=!1,this._decoder=null,this._fatal=Boolean(t.fatal),this._ignoreBOM=Boolean(t.ignoreBOM),Object.defineProperty(this,"encoding",{value:"utf-8"}),Object.defineProperty(this,"fatal",{value:this._fatal}),Object.defineProperty(this,"ignoreBOM",{value:this._ignoreBOM})}function f(e,t){if(!(this instanceof f))return new f(e,t);if((e=void 0!==e?String(e).toLowerCase():c)!==c)throw new Error("Encoding not supported. Only utf-8 is supported");t=i(t),this._streaming=!1,this._encoder=null,this._options={fatal:Boolean(t.fatal)},Object.defineProperty(this,"encoding",{value:"utf-8"})}function h(e){var t=e.fatal,n=0,i=0,a=0,c=128,l=191;this.handler=function(e,f){if(f===o&&0!==a)return a=0,s(t);if(f===o)return u;if(0===a){if(r(f,0,127))return f;if(r(f,194,223))a=1,n=f-192;else if(r(f,224,239))224===f&&(c=160),237===f&&(l=159),a=2,n=f-224;else{if(!r(f,240,244))return s(t);240===f&&(c=144),244===f&&(l=143),a=3,n=f-240}return n<<=6*a,null}if(!r(f,c,l))return n=a=i=0,c=128,l=191,e.prepend(f),s(t);if(c=128,l=191,n+=f-128<<6*(a-(i+=1)),i!==a)return null;var h=n;return n=a=i=0,h}}function d(e){e.fatal;this.handler=function(e,t){if(t===o)return u;if(r(t,0,127))return t;var n,i;r(t,128,2047)?(n=1,i=192):r(t,2048,65535)?(n=2,i=224):r(t,65536,1114111)&&(n=3,i=240);for(var a=[(t>>6*n)+i];n>0;){var s=t>>6*(n-1);a.push(128|63&s),n-=1}return a}}l.prototype={decode:function(e,t){var n;n="object"==typeof e&&e instanceof ArrayBuffer?new Uint8Array(e):"object"==typeof e&&"buffer"in e&&e.buffer instanceof ArrayBuffer?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(0),t=i(t),this._streaming||(this._decoder=new h({fatal:this._fatal}),this._BOMseen=!1),this._streaming=Boolean(t.stream);for(var r,o=new a(n),s=[];!o.endOfStream()&&(r=this._decoder.handler(o,o.read()))!==u;)null!==r&&(Array.isArray(r)?s.push.apply(s,r):s.push(r));if(!this._streaming){do{if((r=this._decoder.handler(o,o.read()))===u)break;null!==r&&(Array.isArray(r)?s.push.apply(s,r):s.push(r))}while(!o.endOfStream());this._decoder=null}return s.length&&(-1===["utf-8"].indexOf(this.encoding)||this._ignoreBOM||this._BOMseen||(65279===s[0]?(this._BOMseen=!0,s.shift()):this._BOMseen=!0)),function(e){for(var t="",n=0;n<e.length;++n){var r=e[n];r<=65535?t+=String.fromCharCode(r):(r-=65536,t+=String.fromCharCode(55296+(r>>10),56320+(1023&r)))}return t}(s)}},f.prototype={encode:function(e,t){e=e?String(e):"",t=i(t),this._streaming||(this._encoder=new d(this._options)),this._streaming=Boolean(t.stream);for(var n,r=[],o=new a(function(e){for(var t=String(e),n=t.length,r=0,i=[];r<n;){var o=t.charCodeAt(r);if(o<55296||o>57343)i.push(o);else if(56320<=o&&o<=57343)i.push(65533);else if(55296<=o&&o<=56319)if(r===n-1)i.push(65533);else{var a=e.charCodeAt(r+1);if(56320<=a&&a<=57343){var u=1023&o,s=1023&a;i.push(65536+(u<<10)+s),r+=1}else i.push(65533)}r+=1}return i}(e));!o.endOfStream()&&(n=this._encoder.handler(o,o.read()))!==u;)Array.isArray(n)?r.push.apply(r,n):r.push(n);if(!this._streaming){for(;(n=this._encoder.handler(o,o.read()))!==u;)Array.isArray(n)?r.push.apply(r,n):r.push(n);this._encoder=null}return new Uint8Array(r)}}},function(e,t,n){"use strict";var r=n(7);Object.defineProperty(t,"__esModule",{value:!0}),t.Dechunker=t.Chunker=void 0;var i=r(n(9)),o=r(n(10)),a=r(n(12)),u=r(n(15)),s=r(n(16)),c=r(n(44)),l=n(42),f=r(n(51)),h=1400,d=function(e){function t(e,n){var r;return(0,i.default)(this,t),(r=(0,a.default)(this,(0,u.default)(t).call(this,0)))._bufferSize=n||h,r._ch=e,r._buffer=(0,l.alloc)(r._bufferSize),r._currentChunkStart=0,r._chunkOpen=!1,r}return(0,s.default)(t,e),(0,o.default)(t,[{key:"putUInt8",value:function(e,t){this._ensure(1),this._buffer.writeUInt8(t)}},{key:"putInt8",value:function(e,t){this._ensure(1),this._buffer.writeInt8(t)}},{key:"putFloat64",value:function(e,t){this._ensure(8),this._buffer.writeFloat64(t)}},{key:"putBytes",value:function(e,t){for(;t.remaining()>0;)this._ensure(1),this._buffer.remaining()>t.remaining()?this._buffer.writeBytes(t):this._buffer.writeBytes(t.readSlice(this._buffer.remaining()));return this}},{key:"flush",value:function(){if(this._buffer.position>0){this._closeChunkIfOpen();var e=this._buffer;this._buffer=null,this._ch.write(e.getSlice(0,e.position)),this._buffer=(0,l.alloc)(this._bufferSize),this._chunkOpen=!1}return this}},{key:"messageBoundary",value:function(){this._closeChunkIfOpen(),this._buffer.remaining()<2&&this.flush(),this._buffer.writeInt16(0)}},{key:"_ensure",value:function(e){var t=this._chunkOpen?e:e+2;this._buffer.remaining()<t&&this.flush(),this._chunkOpen||(this._currentChunkStart=this._buffer.position,this._buffer.position=this._buffer.position+2,this._chunkOpen=!0)}},{key:"_closeChunkIfOpen",value:function(){if(this._chunkOpen){var e=this._buffer.position-(this._currentChunkStart+2);this._buffer.putUInt16(this._currentChunkStart,e),this._chunkOpen=!1}}}]),t}(c.default);t.Chunker=d;var v=function(){function e(){(0,i.default)(this,e),this._currentMessage=[],this._partialChunkHeader=0,this._state=this.AWAITING_CHUNK}return(0,o.default)(e,[{key:"AWAITING_CHUNK",value:function(e){return e.remaining()>=2?this._onHeader(e.readUInt16()):(this._partialChunkHeader=e.readUInt8()<<8,this.IN_HEADER)}},{key:"IN_HEADER",value:function(e){return this._onHeader(65535&(this._partialChunkHeader|e.readUInt8()))}},{key:"IN_CHUNK",value:function(e){return this._chunkSize<=e.remaining()?(this._currentMessage.push(e.readSlice(this._chunkSize)),this.AWAITING_CHUNK):(this._chunkSize-=e.remaining(),this._currentMessage.push(e.readSlice(e.remaining())),this.IN_CHUNK)}},{key:"CLOSED",value:function(e){}},{key:"_onHeader",value:function(e){var t;return 0===e?(t=1===this._currentMessage.length?this._currentMessage[0]:new f.default(this._currentMessage),this._currentMessage=[],this.onmessage(t),this.AWAITING_CHUNK):(this._chunkSize=e,this.IN_CHUNK)}},{key:"write",value:function(e){for(;e.hasRemaining();)this._state=this._state(e)}}]),e}();t.Dechunker=v},function(e,t,n){"use strict";var r=n(7);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(9)),o=r(n(10)),a=r(n(12)),u=r(n(15)),s=r(n(16)),c=r(n(44)),l=n(42),f=function(e){function t(e){var n;(0,i.default)(this,t);for(var r=0,o=0;o<e.length;o++)r+=e[o].length;return(n=(0,a.default)(this,(0,u.default)(t).call(this,r)))._buffers=e,n}return(0,s.default)(t,e),(0,o.default)(t,[{key:"getUInt8",value:function(e){for(var t=0;t<this._buffers.length;t++){var n=this._buffers[t];if(!(e>=n.length))return n.getUInt8(e);e-=n.length}}},{key:"getInt8",value:function(e){for(var t=0;t<this._buffers.length;t++){var n=this._buffers[t];if(!(e>=n.length))return n.getInt8(e);e-=n.length}}},{key:"getFloat64",value:function(e){for(var t=(0,l.alloc)(8),n=0;n<8;n++)t.putUInt8(n,this.getUInt8(e+n));return t.getFloat64(0)}}]),t}(c.default);t.default=f},function(e,t,n){"use strict";var r=n(7);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(9)),o=n(11),a=n(32),u=3e4,s=[null,void 0,!0,!1,a.ENCRYPTION_ON,a.ENCRYPTION_OFF],c=[null,void 0,"TRUST_ALL_CERTIFICATES","TRUST_ON_FIRST_USE","TRUST_SIGNED_CERTIFICATES","TRUST_CUSTOM_CA_SIGNED_CERTIFICATES","TRUST_SYSTEM_CA_SIGNED_CERTIFICATES"];t.default=function e(t,n,r){(0,i.default)(this,e),this.address=t,this.encrypted=function(e){var t=e.encrypted;if(-1===s.indexOf(t))throw(0,o.newError)("Illegal value of the encrypted setting ".concat(t,". Expected one of ").concat(s));return t}(n),this.trust=function(e){var t=e.trust;if(-1===c.indexOf(t))throw(0,o.newError)("Illegal value of the trust setting ".concat(t,". Expected one of ").concat(c));return t}(n),this.trustedCertificates=function(e){return e.trustedCertificates||[]}(n),this.knownHostsPath=function(e){return e.knownHosts||null}(n),this.connectionErrorCode=r||o.SERVICE_UNAVAILABLE,this.connectionTimeout=function(e){var t=parseInt(e.connectionTimeout,10);return 0===t?null:t&&t<0?null:t||u}(n)}},function(e,t,n){"use strict";var r=n(7);Object.defineProperty(t,"__esModule",{value:!0}),t.VERSION_IN_DEV=t.VERSION_4_0_0=t.VERSION_3_5_0=t.VERSION_3_4_0=t.VERSION_3_2_0=t.VERSION_3_1_0=t.ServerVersion=void 0;var i=r(n(9)),o=r(n(10)),a=n(32),u=new RegExp("^(Neo4j/)?(\\d+)\\.(\\d+)(?:\\.)?(\\d*)(\\.|-|\\+)?([0-9A-Za-z-.]*)?$"),s=function(){function e(t,n,r){(0,i.default)(this,e),this.major=t,this.minor=n,this.patch=r}return(0,o.default)(e,[{key:"compareTo",value:function(e){var t=l(this.major,e.major);return 0===t&&0===(t=l(this.minor,e.minor))&&(t=l(this.patch,e.patch)),t}}],[{key:"fromDriver",value:function(t){var n=t.session();return n.run("RETURN 1").then((function(t){return n.close(),e.fromString(t.summary.server.version)}))}},{key:"fromString",value:function(t){if(!t)return new e(3,0,0);if((0,a.assertString)(t,"Neo4j version string"),t.toLowerCase()==="Neo4j/dev".toLowerCase())return y;var n=t.match(u);if(!n)throw new Error("Unparsable Neo4j version: ".concat(t));return new e(c(n[2]),c(n[3]),c(n[4]||0))}}]),e}();function c(e,t){var n=parseInt(e,10);if(!n&&0!==n)throw new Error("Unparsable number ".concat(t,": '").concat(e,"'"));return n}function l(e,t){return e<t?-1:e===t?0:1}t.ServerVersion=s;var f=new s(3,1,0);t.VERSION_3_1_0=f;var h=new s(3,2,0);t.VERSION_3_2_0=h;var d=new s(3,4,0);t.VERSION_3_4_0=d;var v=new s(3,5,0);t.VERSION_3_5_0=v;var _=new s(4,0,0);t.VERSION_4_0_0=_;var p=Number.MAX_SAFE_INTEGER,y=new s(p,p,p);t.VERSION_IN_DEV=y},function(e,t,n){"use strict";var r=n(7);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(9)),o=r(n(10)),a=n(42),u=n(11),s=r(n(55)),c=r(n(58)),l=r(n(67)),f=1616949271,h=function(){function e(t,n,r,o,a){(0,i.default)(this,e),this._connection=t,this._channel=n,this._chunker=r,this._disableLosslessIntegers=o,this._log=a}return(0,o.default)(e,[{key:"writeHandshakeRequest",value:function(){var e;this._channel.write(((e=(0,a.alloc)(20)).writeInt32(f),e.writeInt32(3),e.writeInt32(2),e.writeInt32(1),e.writeInt32(0),e.reset(),e))}},{key:"createNegotiatedProtocol",value:function(e){var t=e.readInt32();return this._log.isDebugEnabled()&&this._log.debug("".concat(this._connection," negotiated protocol version ").concat(t)),this._createProtocolWithVersion(t)}},{key:"_createProtocolWithVersion",value:function(e){switch(e){case 1:return new s.default(this._connection,this._chunker,this._disableLosslessIntegers);case 2:return new c.default(this._connection,this._chunker,this._disableLosslessIntegers);case 3:return new l.default(this._connection,this._chunker,this._disableLosslessIntegers);case 1213486160:throw(0,u.newError)("Server responded HTTP. Make sure you are not trying to connect to the http endpoint (HTTP defaults to port 7474 whereas BOLT defaults to port 7687)");default:throw(0,u.newError)("Unknown Bolt protocol version: "+e)}}}]),e}();t.default=h},function(e,t,n){"use strict";var r=n(4),i=n(7);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=i(n(9)),a=i(n(10)),u=i(n(56)),s=r(n(57)),c=n(11),l=i(n(33)),f=i(n(35)),h=n(36),d=function(){function e(t,n,r){(0,o.default)(this,e),this._connection=t,this._packer=this._createPacker(n),this._unpacker=this._createUnpacker(r)}return(0,a.default)(e,[{key:"packer",value:function(){return this._packer}},{key:"unpacker",value:function(){return this._unpacker}},{key:"transformMetadata",value:function(e){return e}},{key:"initialize",value:function(e,t,n){var r=u.default.init(e,t);this._connection.write(r,n,!0)}},{key:"prepareToClose",value:function(e){}},{key:"beginTransaction",value:function(e,t,n,r){v(t,this._connection,r);var i=u.default.run("BEGIN",e.asBeginTransactionParameters()),o=u.default.pullAll();this._connection.write(i,r,!1),this._connection.write(o,r,!1)}},{key:"commitTransaction",value:function(e){this.run("COMMIT",{},l.default.empty(),f.default.empty(),h.ACCESS_MODE_WRITE,e)}},{key:"rollbackTransaction",value:function(e){this.run("ROLLBACK",{},l.default.empty(),f.default.empty(),h.ACCESS_MODE_WRITE,e)}},{key:"run",value:function(e,t,n,r,i,o){v(r,this._connection,o);var a=u.default.run(e,t),s=u.default.pullAll();this._connection.write(a,o,!1),this._connection.write(s,o,!0)}},{key:"reset",value:function(e){var t=u.default.reset();this._connection.write(t,e,!0)}},{key:"_createPacker",value:function(e){return new s.Packer(e)}},{key:"_createUnpacker",value:function(e){return new s.Unpacker(e)}}]),e}();function v(e,t,n){if(!e.isEmpty()){var r=(0,c.newError)("Driver is connected to the database that does not support transaction configuration. Please upgrade to neo4j 3.5.0 or later in order to use this functionality");throw t._handleFatalError(r),n.onError(r),r}}t.default=d},function(e,t,n){"use strict";var r=n(7);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(9)),o=r(n(10)),a=n(36),u="r",s=function(){function e(t,n,r){(0,i.default)(this,e),this.signature=t,this.fields=n,this.toString=r}return(0,o.default)(e,null,[{key:"init",value:function(t,n){return new e(1,[t,n],(function(){return"INIT ".concat(t," {...}")}))}},{key:"run",value:function(t,n){return new e(16,[t,n],(function(){return"RUN ".concat(t," ").concat(JSON.stringify(n))}))}},{key:"pullAll",value:function(){return l}},{key:"reset",value:function(){return f}},{key:"hello",value:function(t,n){return new e(1,[Object.assign({user_agent:t},n)],(function(){return"HELLO {user_agent: '".concat(t,"', ...}")}))}},{key:"begin",value:function(t,n,r){var i=c(t,n,r);return new e(17,[i],(function(){return"BEGIN ".concat(JSON.stringify(i))}))}},{key:"commit",value:function(){return h}},{key:"rollback",value:function(){return d}},{key:"runWithMetadata",value:function(t,n,r,i,o){var a=c(r,i,o);return new e(16,[t,n,a],(function(){return"RUN ".concat(t," ").concat(JSON.stringify(n)," ").concat(JSON.stringify(a))}))}},{key:"goodbye",value:function(){return v}}]),e}();function c(e,t,n){var r={};return e.isEmpty()||(r.bookmarks=e.values()),t.timeout&&(r.tx_timeout=t.timeout),t.metadata&&(r.tx_metadata=t.metadata),n===a.ACCESS_MODE_READ&&(r.mode=u),r}t.default=s;var l=new s(63,[],(function(){return"PULL_ALL"})),f=new s(15,[],(function(){return"RESET"})),h=new s(18,[],(function(){return"COMMIT"})),d=new s(19,[],(function(){return"ROLLBACK"})),v=new s(2,[],(function(){return"GOODBYE"}))},function(e,t,n){"use strict";var r=n(4),i=n(7);Object.defineProperty(t,"__esModule",{value:!0}),t.Structure=t.Unpacker=t.Packer=void 0;var o=i(n(13)),a=i(n(9)),u=i(n(10)),s=n(42),c=r(n(8)),l=n(11),f=n(21),h=function(){function e(t,n){(0,a.default)(this,e),this.signature=t,this.fields=n}return(0,u.default)(e,[{key:"toString",value:function(){for(var e="",t=0;t<this.fields.length;t++)t>0&&(e+=", "),e+=this.fields[t];return"Structure("+this.signature+", ["+e+"])"}}]),e}();t.Structure=h;var d=function(){function e(t){(0,a.default)(this,e),this._ch=t,this._byteArraysSupported=!0}return(0,u.default)(e,[{key:"packable",value:function(e,t){var n=this;if(null===e)return function(){return n._ch.writeUInt8(192)};if(!0===e)return function(){return n._ch.writeUInt8(195)};if(!1===e)return function(){return n._ch.writeUInt8(194)};if("number"==typeof e)return function(){return n.packFloat(e)};if("string"==typeof e)return function(){return n.packString(e,t)};if((0,c.isInt)(e))return function(){return n.packInteger(e)};if(e instanceof Int8Array)return function(){return n.packBytes(e,t)};if(e instanceof Array)return function(){n.packListHeader(e.length,t);for(var r=0;r<e.length;r++)n.packable(void 0===e[r]?null:e[r],t)()};if(function(e){if(null==e)return!1;return"function"==typeof e[Symbol.iterator]}(e))return this.packableIterable(e,t);if(e instanceof f.Node)return this._nonPackableValue("It is not allowed to pass nodes in query parameters, given: ".concat(e),t);if(e instanceof f.Relationship)return this._nonPackableValue("It is not allowed to pass relationships in query parameters, given: ".concat(e),t);if(e instanceof f.Path)return this._nonPackableValue("It is not allowed to pass paths in query parameters, given: ".concat(e),t);if(e instanceof h){for(var r=[],i=0;i<e.fields.length;i++)r[i]=this.packable(e.fields[i],t);return function(){return n.packStruct(e.signature,r)}}return"object"===(0,o.default)(e)?function(){for(var r=Object.keys(e),i=0,o=0;o<r.length;o++)void 0!==e[r[o]]&&i++;n.packMapHeader(i,t);for(var a=0;a<r.length;a++){var u=r[a];void 0!==e[u]&&(n.packString(u),n.packable(e[u],t)())}}:this._nonPackableValue("Unable to pack the given value: ".concat(e),t)}},{key:"packableIterable",value:function(e,t){try{var n=Array.from(e);return this.packable(n,t)}catch(n){t((0,l.newError)("Cannot pack given iterable, ".concat(n.message,": ").concat(e)))}}},{key:"packStruct",value:function(e,t,n){t=t||[],this.packStructHeader(t.length,e,n);for(var r=0;r<t.length;r++)t[r]()}},{key:"packInteger",value:function(e){var t=e.high,n=e.low;e.greaterThanOrEqual(-16)&&e.lessThan(128)?this._ch.writeInt8(n):e.greaterThanOrEqual(-128)&&e.lessThan(-16)?(this._ch.writeUInt8(200),this._ch.writeInt8(n)):e.greaterThanOrEqual(-32768)&&e.lessThan(32768)?(this._ch.writeUInt8(201),this._ch.writeInt16(n)):e.greaterThanOrEqual(-2147483648)&&e.lessThan(2147483648)?(this._ch.writeUInt8(202),this._ch.writeInt32(n)):(this._ch.writeUInt8(203),this._ch.writeInt32(t),this._ch.writeInt32(n))}},{key:"packFloat",value:function(e){this._ch.writeUInt8(193),this._ch.writeFloat64(e)}},{key:"packString",value:function(e,t){var n=s.utf8.encode(e),r=n.length;r<16?(this._ch.writeUInt8(128|r),this._ch.writeBytes(n)):r<256?(this._ch.writeUInt8(208),this._ch.writeUInt8(r),this._ch.writeBytes(n)):r<65536?(this._ch.writeUInt8(209),this._ch.writeUInt8(r/256>>0),this._ch.writeUInt8(r%256),this._ch.writeBytes(n)):r<4294967296?(this._ch.writeUInt8(210),this._ch.writeUInt8((r/16777216>>0)%256),this._ch.writeUInt8((r/65536>>0)%256),this._ch.writeUInt8((r/256>>0)%256),this._ch.writeUInt8(r%256),this._ch.writeBytes(n)):t((0,l.newError)("UTF-8 strings of size "+r+" are not supported"))}},{key:"packListHeader",value:function(e,t){e<16?this._ch.writeUInt8(144|e):e<256?(this._ch.writeUInt8(212),this._ch.writeUInt8(e)):e<65536?(this._ch.writeUInt8(213),this._ch.writeUInt8((e/256>>0)%256),this._ch.writeUInt8(e%256)):e<4294967296?(this._ch.writeUInt8(214),this._ch.writeUInt8((e/16777216>>0)%256),this._ch.writeUInt8((e/65536>>0)%256),this._ch.writeUInt8((e/256>>0)%256),this._ch.writeUInt8(e%256)):t((0,l.newError)("Lists of size "+e+" are not supported"))}},{key:"packBytes",value:function(e,t){if(this._byteArraysSupported){this.packBytesHeader(e.length,t);for(var n=0;n<e.length;n++)this._ch.writeInt8(e[n])}else t((0,l.newError)("Byte arrays are not supported by the database this driver is connected to"))}},{key:"packBytesHeader",value:function(e,t){e<256?(this._ch.writeUInt8(204),this._ch.writeUInt8(e)):e<65536?(this._ch.writeUInt8(205),this._ch.writeUInt8((e/256>>0)%256),this._ch.writeUInt8(e%256)):e<4294967296?(this._ch.writeUInt8(206),this._ch.writeUInt8((e/16777216>>0)%256),this._ch.writeUInt8((e/65536>>0)%256),this._ch.writeUInt8((e/256>>0)%256),this._ch.writeUInt8(e%256)):t((0,l.newError)("Byte arrays of size "+e+" are not supported"))}},{key:"packMapHeader",value:function(e,t){e<16?this._ch.writeUInt8(160|e):e<256?(this._ch.writeUInt8(216),this._ch.writeUInt8(e)):e<65536?(this._ch.writeUInt8(217),this._ch.writeUInt8(e/256>>0),this._ch.writeUInt8(e%256)):e<4294967296?(this._ch.writeUInt8(218),this._ch.writeUInt8((e/16777216>>0)%256),this._ch.writeUInt8((e/65536>>0)%256),this._ch.writeUInt8((e/256>>0)%256),this._ch.writeUInt8(e%256)):t((0,l.newError)("Maps of size "+e+" are not supported"))}},{key:"packStructHeader",value:function(e,t,n){e<16?(this._ch.writeUInt8(176|e),this._ch.writeUInt8(t)):e<256?(this._ch.writeUInt8(220),this._ch.writeUInt8(e),this._ch.writeUInt8(t)):e<65536?(this._ch.writeUInt8(221),this._ch.writeUInt8(e/256>>0),this._ch.writeUInt8(e%256)):n((0,l.newError)("Structures of size "+e+" are not supported"))}},{key:"disableByteArrays",value:function(){this._byteArraysSupported=!1}},{key:"_nonPackableValue",value:function(e,t){return t&&t((0,l.newError)(e,l.PROTOCOL_ERROR)),function(){}}}]),e}();t.Packer=d;var v=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(0,a.default)(this,e),this._disableLosslessIntegers=t}return(0,u.default)(e,[{key:"unpack",value:function(e){var t=e.readUInt8(),n=240&t,r=15&t;if(192===t)return null;var i=this._unpackBoolean(t);if(null!==i)return i;var o=this._unpackNumberOrInteger(t,e);if(null!==o)return this._disableLosslessIntegers&&(0,c.isInt)(o)?o.toNumberOrInfinity():o;var a=this._unpackString(t,n,r,e);if(null!==a)return a;var u=this._unpackList(t,n,r,e);if(null!==u)return u;var s=this._unpackByteArray(t,e);if(null!==s)return s;var f=this._unpackMap(t,n,r,e);if(null!==f)return f;var h=this._unpackStruct(t,n,r,e);if(null!==h)return h;throw(0,l.newError)("Unknown packed value with marker "+t.toString(16))}},{key:"unpackInteger",value:function(e){var t=e.readUInt8(),n=this._unpackInteger(t,e);if(null==n)throw(0,l.newError)("Unable to unpack integer value with marker "+t.toString(16));return n}},{key:"_unpackBoolean",value:function(e){return 195===e||194!==e&&null}},{key:"_unpackNumberOrInteger",value:function(e,t){return 193===e?t.readFloat64():this._unpackInteger(e,t)}},{key:"_unpackInteger",value:function(e,t){if(e>=0&&e<128)return(0,c.int)(e);if(e>=240&&e<256)return(0,c.int)(e-256);if(200===e)return(0,c.int)(t.readInt8());if(201===e)return(0,c.int)(t.readInt16());if(202===e){var n=t.readInt32();return(0,c.int)(n)}if(203===e){var r=t.readInt32(),i=t.readInt32();return new c.default(i,r)}return null}},{key:"_unpackString",value:function(e,t,n,r){return 128===t?s.utf8.decode(r,n):208===e?s.utf8.decode(r,r.readUInt8()):209===e?s.utf8.decode(r,r.readUInt16()):210===e?s.utf8.decode(r,r.readUInt32()):null}},{key:"_unpackList",value:function(e,t,n,r){return 144===t?this._unpackListWithSize(n,r):212===e?this._unpackListWithSize(r.readUInt8(),r):213===e?this._unpackListWithSize(r.readUInt16(),r):214===e?this._unpackListWithSize(r.readUInt32(),r):null}},{key:"_unpackListWithSize",value:function(e,t){for(var n=[],r=0;r<e;r++)n.push(this.unpack(t));return n}},{key:"_unpackByteArray",value:function(e,t){return 204===e?this._unpackByteArrayWithSize(t.readUInt8(),t):205===e?this._unpackByteArrayWithSize(t.readUInt16(),t):206===e?this._unpackByteArrayWithSize(t.readUInt32(),t):null}},{key:"_unpackByteArrayWithSize",value:function(e,t){for(var n=new Int8Array(e),r=0;r<e;r++)n[r]=t.readInt8();return n}},{key:"_unpackMap",value:function(e,t,n,r){return 160===t?this._unpackMapWithSize(n,r):216===e?this._unpackMapWithSize(r.readUInt8(),r):217===e?this._unpackMapWithSize(r.readUInt16(),r):218===e?this._unpackMapWithSize(r.readUInt32(),r):null}},{key:"_unpackMapWithSize",value:function(e,t){for(var n={},r=0;r<e;r++){n[this.unpack(t)]=this.unpack(t)}return n}},{key:"_unpackStruct",value:function(e,t,n,r){return 176===t?this._unpackStructWithSize(n,r):220===e?this._unpackStructWithSize(r.readUInt8(),r):221===e?this._unpackStructWithSize(r.readUInt16(),r):null}},{key:"_unpackStructWithSize",value:function(e,t){var n=t.readUInt8();return 78===n?this._unpackNode(e,t):82===n?this._unpackRelationship(e,t):114===n?this._unpackUnboundRelationship(e,t):80===n?this._unpackPath(e,t):this._unpackUnknownStruct(n,e,t)}},{key:"_unpackNode",value:function(e,t){return this._verifyStructSize("Node",3,e),new f.Node(this.unpack(t),this.unpack(t),this.unpack(t))}},{key:"_unpackRelationship",value:function(e,t){return this._verifyStructSize("Relationship",5,e),new f.Relationship(this.unpack(t),this.unpack(t),this.unpack(t),this.unpack(t),this.unpack(t))}},{key:"_unpackUnboundRelationship",value:function(e,t){return this._verifyStructSize("UnboundRelationship",3,e),new f.UnboundRelationship(this.unpack(t),this.unpack(t),this.unpack(t))}},{key:"_unpackPath",value:function(e,t){this._verifyStructSize("Path",3,e);for(var n=this.unpack(t),r=this.unpack(t),i=this.unpack(t),o=[],a=n[0],u=0;u<i.length;u+=2){var s=n[i[u+1]],c=i[u],l=void 0;c>0?(l=r[c-1])instanceof f.UnboundRelationship&&(r[c-1]=l=l.bind(a.identity,s.identity)):(l=r[-c-1])instanceof f.UnboundRelationship&&(r[-c-1]=l=l.bind(s.identity,a.identity)),o.push(new f.PathSegment(a,l,s)),a=s}return new f.Path(n[0],n[n.length-1],o)}},{key:"_unpackUnknownStruct",value:function(e,t,n){for(var r=new h(e,[]),i=0;i<t;i++)r.fields.push(this.unpack(n));return r}},{key:"_verifyStructSize",value:function(e,t,n){if(t!==n)throw(0,l.newError)("Wrong struct size for ".concat(e,", expected ").concat(t," but was ").concat(n),l.PROTOCOL_ERROR)}}]),e}();t.Unpacker=v},function(e,t,n){"use strict";var r=n(4),i=n(7);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=i(n(9)),a=i(n(10)),u=i(n(12)),s=i(n(15)),c=i(n(16)),l=i(n(55)),f=r(n(59)),h=function(e){function t(){return(0,o.default)(this,t),(0,u.default)(this,(0,s.default)(t).apply(this,arguments))}return(0,c.default)(t,e),(0,a.default)(t,[{key:"_createPacker",value:function(e){return new f.Packer(e)}},{key:"_createUnpacker",value:function(e){return new f.Unpacker(e)}}]),t}(l.default);t.default=h},function(e,t,n){"use strict";var r=n(4),i=n(7);Object.defineProperty(t,"__esModule",{value:!0}),t.Unpacker=t.Packer=void 0;var o=i(n(9)),a=i(n(10)),u=i(n(12)),s=i(n(15)),c=i(n(28)),l=i(n(16)),f=r(n(57)),h=n(60),d=n(61),v=n(8),_=n(66),p=88,y=3,g=89,m=4,b=69,k=4,w=116,E=1,I=84,S=2,O=68,T=1,C=100,R=2,N=70,P=3,A=102,U=3,D=function(e){function t(){return(0,o.default)(this,t),(0,u.default)(this,(0,s.default)(t).apply(this,arguments))}return(0,l.default)(t,e),(0,a.default)(t,[{key:"disableByteArrays",value:function(){throw new Error("Bolt V2 should always support byte arrays")}},{key:"packable",value:function(e,n){var r=this;return(0,h.isPoint)(e)?function(){return function(e,t,n){null===e.z||void 0===e.z?function(e,t,n){var r=[t.packable((0,v.int)(e.srid),n),t.packable(e.x,n),t.packable(e.y,n)];t.packStruct(p,r,n)}(e,t,n):function(e,t,n){var r=[t.packable((0,v.int)(e.srid),n),t.packable(e.x,n),t.packable(e.y,n),t.packable(e.z,n)];t.packStruct(g,r,n)}(e,t,n)}(e,r,n)}:(0,d.isDuration)(e)?function(){return function(e,t,n){var r=(0,v.int)(e.months),i=(0,v.int)(e.days),o=(0,v.int)(e.seconds),a=(0,v.int)(e.nanoseconds),u=[t.packable(r,n),t.packable(i,n),t.packable(o,n),t.packable(a,n)];t.packStruct(b,u,n)}(e,r,n)}:(0,d.isLocalTime)(e)?function(){return function(e,t,n){var r=(0,_.localTimeToNanoOfDay)(e.hour,e.minute,e.second,e.nanosecond),i=[t.packable(r,n)];t.packStruct(w,i,n)}(e,r,n)}:(0,d.isTime)(e)?function(){return function(e,t,n){var r=(0,_.localTimeToNanoOfDay)(e.hour,e.minute,e.second,e.nanosecond),i=(0,v.int)(e.timeZoneOffsetSeconds),o=[t.packable(r,n),t.packable(i,n)];t.packStruct(I,o,n)}(e,r,n)}:(0,d.isDate)(e)?function(){return function(e,t,n){var r=(0,_.dateToEpochDay)(e.year,e.month,e.day),i=[t.packable(r,n)];t.packStruct(O,i,n)}(e,r,n)}:(0,d.isLocalDateTime)(e)?function(){return function(e,t,n){var r=(0,_.localDateTimeToEpochSecond)(e.year,e.month,e.day,e.hour,e.minute,e.second,e.nanosecond),i=(0,v.int)(e.nanosecond),o=[t.packable(r,n),t.packable(i,n)];t.packStruct(C,o,n)}(e,r,n)}:(0,d.isDateTime)(e)?function(){return function(e,t,n){e.timeZoneId?function(e,t,n){var r=(0,_.localDateTimeToEpochSecond)(e.year,e.month,e.day,e.hour,e.minute,e.second,e.nanosecond),i=(0,v.int)(e.nanosecond),o=e.timeZoneId,a=[t.packable(r,n),t.packable(i,n),t.packable(o,n)];t.packStruct(A,a,n)}(e,t,n):function(e,t,n){var r=(0,_.localDateTimeToEpochSecond)(e.year,e.month,e.day,e.hour,e.minute,e.second,e.nanosecond),i=(0,v.int)(e.nanosecond),o=(0,v.int)(e.timeZoneOffsetSeconds),a=[t.packable(r,n),t.packable(i,n),t.packable(o,n)];t.packStruct(N,a,n)}(e,t,n)}(e,r,n)}:(0,c.default)((0,s.default)(t.prototype),"packable",this).call(this,e,n)}}]),t}(f.Packer);t.Packer=D;var x=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return(0,o.default)(this,t),(0,u.default)(this,(0,s.default)(t).call(this,e))}return(0,l.default)(t,e),(0,a.default)(t,[{key:"_unpackUnknownStruct",value:function(e,n,r){return e===p?function(e,t,n){return e._verifyStructSize("Point2D",y,t),new h.Point(e.unpack(n),e.unpack(n),e.unpack(n),void 0)}(this,n,r):e===g?function(e,t,n){return e._verifyStructSize("Point3D",m,t),new h.Point(e.unpack(n),e.unpack(n),e.unpack(n),e.unpack(n))}(this,n,r):e===b?function(e,t,n){e._verifyStructSize("Duration",k,t);var r=e.unpack(n),i=e.unpack(n),o=e.unpack(n),a=e.unpack(n);return new d.Duration(r,i,o,a)}(this,n,r):e===w?function(e,t,n,r){e._verifyStructSize("LocalTime",E,t);var i=e.unpackInteger(n);return j((0,_.nanoOfDayToLocalTime)(i),r)}(this,n,r,this._disableLosslessIntegers):e===I?function(e,t,n,r){e._verifyStructSize("Time",S,t);var i=e.unpackInteger(n),o=e.unpackInteger(n),a=(0,_.nanoOfDayToLocalTime)(i);return j(new d.Time(a.hour,a.minute,a.second,a.nanosecond,o),r)}(this,n,r,this._disableLosslessIntegers):e===O?function(e,t,n,r){e._verifyStructSize("Date",T,t);var i=e.unpackInteger(n);return j((0,_.epochDayToDate)(i),r)}(this,n,r,this._disableLosslessIntegers):e===C?function(e,t,n,r){e._verifyStructSize("LocalDateTime",R,t);var i=e.unpackInteger(n),o=e.unpackInteger(n);return j((0,_.epochSecondAndNanoToLocalDateTime)(i,o),r)}(this,n,r,this._disableLosslessIntegers):e===N?function(e,t,n,r){e._verifyStructSize("DateTimeWithZoneOffset",P,t);var i=e.unpackInteger(n),o=e.unpackInteger(n),a=e.unpackInteger(n),u=(0,_.epochSecondAndNanoToLocalDateTime)(i,o);return j(new d.DateTime(u.year,u.month,u.day,u.hour,u.minute,u.second,u.nanosecond,a,null),r)}(this,n,r,this._disableLosslessIntegers):e===A?function(e,t,n,r){e._verifyStructSize("DateTimeWithZoneId",U,t);var i=e.unpackInteger(n),o=e.unpackInteger(n),a=e.unpack(n),u=(0,_.epochSecondAndNanoToLocalDateTime)(i,o);return j(new d.DateTime(u.year,u.month,u.day,u.hour,u.minute,u.second,u.nanosecond,null,a),r)}(this,n,r,this._disableLosslessIntegers):(0,c.default)((0,s.default)(t.prototype),"_unpackUnknownStruct",this).call(this,e,n,r,this._disableLosslessIntegers)}}]),t}(f.Unpacker);function j(e,t){if(!t)return e;var n=Object.create(Object.getPrototypeOf(e));for(var r in e)if(e.hasOwnProperty(r)){var i=e[r];n[r]=(0,v.isInt)(i)?i.toNumberOrInfinity():i}return Object.freeze(n),n}t.Unpacker=x},function(e,t,n){"use strict";var r=n(7);Object.defineProperty(t,"__esModule",{value:!0}),t.isPoint=function(e){return!0===(e&&e[u])},t.Point=void 0;var i=r(n(9)),o=r(n(10)),a=n(32),u="__isPoint__",s=function(){function e(t,n,r,o){(0,i.default)(this,e),this.srid=(0,a.assertNumberOrInteger)(t,"SRID"),this.x=(0,a.assertNumber)(n,"X coordinate"),this.y=(0,a.assertNumber)(r,"Y coordinate"),this.z=null==o?o:(0,a.assertNumber)(o,"Z coordinate"),Object.freeze(this)}return(0,o.default)(e,[{key:"toString",value:function(){return this.z||0===this.z?"Point{srid=".concat(c(this.srid),", x=").concat(c(this.x),", y=").concat(c(this.y),", z=").concat(c(this.z),"}"):"Point{srid=".concat(c(this.srid),", x=").concat(c(this.x),", y=").concat(c(this.y),"}")}}]),e}();function c(e){return Number.isInteger(e)?e+".0":e.toString()}t.Point=s,Object.defineProperty(s.prototype,u,{value:!0,enumerable:!1,configurable:!1})},function(e,t,n){"use strict";var r=n(4),i=n(7);Object.defineProperty(t,"__esModule",{value:!0}),t.isDuration=function(e){return I(e,h)},t.isLocalTime=function(e){return I(e,d)},t.isTime=function(e){return I(e,v)},t.isDate=function(e){return I(e,_)},t.isLocalDateTime=function(e){return I(e,p)},t.isDateTime=function(e){return I(e,y)},t.DateTime=t.LocalDateTime=t.Date=t.Time=t.LocalTime=t.Duration=void 0;var o=i(n(62)),a=i(n(9)),u=i(n(10)),s=r(n(66)),c=n(32),l=n(11),f={value:!0,enumerable:!1,configurable:!1},h="__isDuration__",d="__isLocalTime__",v="__isTime__",_="__isDate__",p="__isLocalDateTime__",y="__isDateTime__",g=function(){function e(t,n,r,i){(0,a.default)(this,e),this.months=(0,c.assertNumberOrInteger)(t,"Months"),this.days=(0,c.assertNumberOrInteger)(n,"Days"),(0,c.assertNumberOrInteger)(r,"Seconds"),(0,c.assertNumberOrInteger)(i,"Nanoseconds"),this.seconds=s.normalizeSecondsForDuration(r,i),this.nanoseconds=s.normalizeNanosecondsForDuration(i),Object.freeze(this)}return(0,u.default)(e,[{key:"toString",value:function(){return s.durationToIsoString(this.months,this.days,this.seconds,this.nanoseconds)}}]),e}();t.Duration=g,Object.defineProperty(g.prototype,h,f);var m=function(){function e(t,n,r,i){(0,a.default)(this,e),this.hour=s.assertValidHour(t),this.minute=s.assertValidMinute(n),this.second=s.assertValidSecond(r),this.nanosecond=s.assertValidNanosecond(i),Object.freeze(this)}return(0,u.default)(e,[{key:"toString",value:function(){return s.timeToIsoString(this.hour,this.minute,this.second,this.nanosecond)}}],[{key:"fromStandardDate",value:function(t,n){return O(t,n),new e(t.getHours(),t.getMinutes(),t.getSeconds(),s.totalNanoseconds(t,n))}}]),e}();t.LocalTime=m,Object.defineProperty(m.prototype,d,f);var b=function(){function e(t,n,r,i,o){(0,a.default)(this,e),this.hour=s.assertValidHour(t),this.minute=s.assertValidMinute(n),this.second=s.assertValidSecond(r),this.nanosecond=s.assertValidNanosecond(i),this.timeZoneOffsetSeconds=(0,c.assertNumberOrInteger)(o,"Time zone offset in seconds"),Object.freeze(this)}return(0,u.default)(e,[{key:"toString",value:function(){return s.timeToIsoString(this.hour,this.minute,this.second,this.nanosecond)+s.timeZoneOffsetToIsoString(this.timeZoneOffsetSeconds)}}],[{key:"fromStandardDate",value:function(t,n){return O(t,n),new e(t.getHours(),t.getMinutes(),t.getSeconds(),s.totalNanoseconds(t,n),s.timeZoneOffsetInSeconds(t))}}]),e}();t.Time=b,Object.defineProperty(b.prototype,v,f);var k=function(){function e(t,n,r){(0,a.default)(this,e),this.year=s.assertValidYear(t),this.month=s.assertValidMonth(n),this.day=s.assertValidDay(r),Object.freeze(this)}return(0,u.default)(e,[{key:"toString",value:function(){return s.dateToIsoString(this.year,this.month,this.day)}}],[{key:"fromStandardDate",value:function(t){return O(t,null),new e(t.getFullYear(),t.getMonth()+1,t.getDate())}}]),e}();t.Date=k,Object.defineProperty(k.prototype,_,f);var w=function(){function e(t,n,r,i,o,u,c){(0,a.default)(this,e),this.year=s.assertValidYear(t),this.month=s.assertValidMonth(n),this.day=s.assertValidDay(r),this.hour=s.assertValidHour(i),this.minute=s.assertValidMinute(o),this.second=s.assertValidSecond(u),this.nanosecond=s.assertValidNanosecond(c),Object.freeze(this)}return(0,u.default)(e,[{key:"toString",value:function(){return S(this.year,this.month,this.day,this.hour,this.minute,this.second,this.nanosecond)}}],[{key:"fromStandardDate",value:function(t,n){return O(t,n),new e(t.getFullYear(),t.getMonth()+1,t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),s.totalNanoseconds(t,n))}}]),e}();t.LocalDateTime=w,Object.defineProperty(w.prototype,p,f);var E=function(){function e(t,n,r,i,u,f,h,d,v){(0,a.default)(this,e),this.year=s.assertValidYear(t),this.month=s.assertValidMonth(n),this.day=s.assertValidDay(r),this.hour=s.assertValidHour(i),this.minute=s.assertValidMinute(u),this.second=s.assertValidSecond(f),this.nanosecond=s.assertValidNanosecond(h);var _=function(e,t){var n=e||0===e,r=t&&""!==t;if(n&&!r)return(0,c.assertNumberOrInteger)(e,"Time zone offset in seconds"),[e,null];if(!n&&r)return(0,c.assertString)(t,"Time zone ID"),[null,t];throw n&&r?(0,l.newError)("Unable to create DateTime with both time zone offset and id. Please specify either of them. Given offset: ".concat(e," and id: ").concat(t)):(0,l.newError)("Unable to create DateTime without either time zone offset or id. Please specify either of them. Given offset: ".concat(e," and id: ").concat(t))}(d,v),p=(0,o.default)(_,2),y=p[0],g=p[1];this.timeZoneOffsetSeconds=y,this.timeZoneId=g,Object.freeze(this)}return(0,u.default)(e,[{key:"toString",value:function(){return S(this.year,this.month,this.day,this.hour,this.minute,this.second,this.nanosecond)+(this.timeZoneId?"[".concat(this.timeZoneId,"]"):s.timeZoneOffsetToIsoString(this.timeZoneOffsetSeconds))}}],[{key:"fromStandardDate",value:function(t,n){return O(t,n),new e(t.getFullYear(),t.getMonth()+1,t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),s.totalNanoseconds(t,n),s.timeZoneOffsetInSeconds(t),null)}}]),e}();function I(e,t){return!0===(e&&e[t])}function S(e,t,n,r,i,o,a){return s.dateToIsoString(e,t,n)+"T"+s.timeToIsoString(r,i,o,a)}function O(e,t){(0,c.assertValidDate)(e,"Standard date"),null!=t&&(0,c.assertNumberOrInteger)(t,"Nanosecond")}t.DateTime=E,Object.defineProperty(E.prototype,y,f)},function(e,t,n){var r=n(63),i=n(64),o=n(65);e.exports=function(e,t){return r(e)||i(e,t)||o()}},function(e,t){e.exports=function(e){if(Array.isArray(e))return e}},function(e,t){e.exports=function(e,t){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)){var n=[],r=!0,i=!1,o=void 0;try{for(var a,u=e[Symbol.iterator]();!(r=(a=u.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){i=!0,o=e}finally{try{r||null==u.return||u.return()}finally{if(i)throw o}}return n}}},function(e,t){e.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}},function(e,t,n){"use strict";var r=n(7);Object.defineProperty(t,"__esModule",{value:!0}),t.normalizeSecondsForDuration=function(e,t){return(0,a.int)(e).add(A(t,k))},t.normalizeNanosecondsForDuration=function(e){return U(e,k)},t.localTimeToNanoOfDay=function(e,t,n,r){e=(0,a.int)(e),t=(0,a.int)(t),n=(0,a.int)(n),r=(0,a.int)(r);var i=e.multiply(I);return(i=(i=i.add(t.multiply(E))).add(n.multiply(k))).add(r)},t.nanoOfDayToLocalTime=C,t.localDateTimeToEpochSecond=function(e,t,n,r,i,o,u){var s=R(e,t,n),c=function(e,t,n){e=(0,a.int)(e),t=(0,a.int)(t),n=(0,a.int)(n);var r=e.multiply(b);return(r=r.add(t.multiply(m))).add(n)}(r,i,o);return s.multiply(T).add(c)},t.epochSecondAndNanoToLocalDateTime=function(e,t){var n=A(e,T),r=U(e,T).multiply(k).add(t),i=N(n),o=C(r);return new u.LocalDateTime(i.year,i.month,i.day,o.hour,o.minute,o.second,o.nanosecond)},t.dateToEpochDay=R,t.epochDayToDate=N,t.durationToIsoString=function(e,t,n,r){var i=x(e),o=x(t),u=function(e,t){var n,r;e=(0,a.int)(e),t=(0,a.int)(t);var i=e.isNegative(),o=t.greaterThan(0);n=i&&o?e.equals(-1)?"-0":e.add(1).toString():e.toString();o&&(r=D(i?t.negate().add(2*k).modulo(k):t.add(k).modulo(k)));return r?n+r:n}(n,r);return"P".concat(i,"M").concat(o,"DT").concat(u,"S")},t.timeToIsoString=function(e,t,n,r){var i=x(e,2),o=x(t,2),a=x(n,2),u=D(r);return"".concat(i,":").concat(o,":").concat(a).concat(u)},t.timeZoneOffsetToIsoString=function(e){if((e=(0,a.int)(e)).equals(0))return"Z";var t=e.isNegative();t&&(e=e.multiply(-1));var n=t?"-":"+",r=x(e.div(b),2),i=x(e.div(m).modulo(g),2),o=e.modulo(m),u=o.equals(0)?null:x(o,2);return u?"".concat(n).concat(r,":").concat(i,":").concat(u):"".concat(n).concat(r,":").concat(i)},t.dateToIsoString=function(e,t,n){var r=(e=(0,a.int)(e)).isNegative();r&&(e=e.multiply(-1));var i=x(e,4);r&&(i="-"+i);var o=x(t,2),u=x(n,2);return"".concat(i,"-").concat(o,"-").concat(u)},t.totalNanoseconds=function(e,t){t=t||0;var n=e.getMilliseconds()*w;return(0,a.isInt)(t)?t.add(n):t+n},t.timeZoneOffsetInSeconds=function(e){var t=e.getTimezoneOffset();if(0===t)return 0;return-1*t*m},t.assertValidYear=function(e){return P(e,f,"Year")},t.assertValidMonth=function(e){return P(e,h,"Month")},t.assertValidDay=function(e){return P(e,d,"Day")},t.assertValidHour=function(e){return P(e,v,"Hour")},t.assertValidMinute=function(e){return P(e,_,"Minute")},t.assertValidSecond=function(e){return P(e,p,"Second")},t.assertValidNanosecond=function(e){return P(e,y,"Nanosecond")};var i=r(n(9)),o=r(n(10)),a=n(8),u=n(61),s=n(32),c=n(11),l=function(){function e(t,n){(0,i.default)(this,e),this._minNumber=t,this._maxNumber=n,this._minInteger=(0,a.int)(t),this._maxInteger=(0,a.int)(n)}return(0,o.default)(e,[{key:"contains",value:function(e){return(0,a.isInt)(e)?e.greaterThanOrEqual(this._minInteger)&&e.lessThanOrEqual(this._maxInteger):e>=this._minNumber&&e<=this._maxNumber}},{key:"toString",value:function(){return"[".concat(this._minNumber,", ").concat(this._maxNumber,"]")}}]),e}(),f=new l(-999999999,999999999),h=new l(1,12),d=new l(1,31),v=new l(0,23),_=new l(0,59),p=new l(0,59),y=new l(0,999999999),g=60,m=60,b=m*g,k=1e9,w=1e6,E=k*m,I=E*g,S=719528,O=146097,T=86400;function C(e){var t=(e=(0,a.int)(e)).div(I),n=(e=e.subtract(t.multiply(I))).div(E),r=(e=e.subtract(n.multiply(E))).div(k),i=e.subtract(r.multiply(k));return new u.LocalTime(t,n,r,i)}function R(e,t,n){e=(0,a.int)(e),t=(0,a.int)(t),n=(0,a.int)(n);var r=e.multiply(365);return r=(r=(r=e.greaterThanOrEqual(0)?r.add(e.add(3).div(4).subtract(e.add(99).div(100)).add(e.add(399).div(400))):r.subtract(e.div(-4).subtract(e.div(-100)).add(e.div(-400)))).add(t.multiply(367).subtract(362).div(12))).add(n.subtract(1)),t.greaterThan(2)&&(r=r.subtract(1),function(e){return!!(e=(0,a.int)(e)).modulo(4).equals(0)&&(!e.modulo(100).equals(0)||!!e.modulo(400).equals(0))}(e)||(r=r.subtract(1))),r.subtract(S)}function N(e){var t=(e=(0,a.int)(e)).add(S).subtract(60),n=(0,a.int)(0);if(t.lessThan(0)){var r=t.add(1).div(O).subtract(1);n=r.multiply(400),t=t.add(r.multiply(-O))}var i=t.multiply(400).add(591).div(O),o=t.subtract(i.multiply(365).add(i.div(4)).subtract(i.div(100)).add(i.div(400)));o.lessThan(0)&&(i=i.subtract(1),o=t.subtract(i.multiply(365).add(i.div(4)).subtract(i.div(100)).add(i.div(400)))),i=i.add(n);var s=o,c=s.multiply(5).add(2).div(153),l=c.add(2).modulo(12).add(1),f=s.subtract(c.multiply(306).add(5).div(10)).add(1);return i=i.add(c.div(10)),new u.Date(i,l,f)}function P(e,t,n){if((0,s.assertNumberOrInteger)(e,n),!t.contains(e))throw(0,c.newError)("".concat(n," is expected to be in range ").concat(t," but was: ").concat(e));return e}function A(e,t){e=(0,a.int)(e),t=(0,a.int)(t);var n=e.div(t);return e.isPositive()!==t.isPositive()&&n.multiply(t).notEquals(e)&&(n=n.subtract(1)),n}function U(e,t){return e=(0,a.int)(e),t=(0,a.int)(t),e.subtract(A(e,t).multiply(t))}function D(e){return(e=(0,a.int)(e)).equals(0)?"":"."+x(e,9)}function x(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,n=(e=(0,a.int)(e)).isNegative();n&&(e=e.negate());var r=e.toString();if(t)for(;r.length<t;)r="0"+r;return n?"-"+r:r}},function(e,t,n){"use strict";var r=n(7);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(9)),o=r(n(10)),a=r(n(12)),u=r(n(15)),s=r(n(16)),c=r(n(58)),l=r(n(56)),f=function(e){function t(){return(0,i.default)(this,t),(0,a.default)(this,(0,u.default)(t).apply(this,arguments))}return(0,s.default)(t,e),(0,o.default)(t,[{key:"transformMetadata",value:function(e){return"t_first"in e&&(e.result_available_after=e.t_first,delete e.t_first),"t_last"in e&&(e.result_consumed_after=e.t_last,delete e.t_last),e}},{key:"initialize",value:function(e,t,n){h(n);var r=l.default.hello(e,t);this._connection.write(r,n,!0)}},{key:"prepareToClose",value:function(e){var t=l.default.goodbye();this._connection.write(t,e,!0)}},{key:"beginTransaction",value:function(e,t,n,r){h(r);var i=l.default.begin(e,t,n);this._connection.write(i,r,!0)}},{key:"commitTransaction",value:function(e){h(e);var t=l.default.commit();this._connection.write(t,e,!0)}},{key:"rollbackTransaction",value:function(e){h(e);var t=l.default.rollback();this._connection.write(t,e,!0)}},{key:"run",value:function(e,t,n,r,i,o){var a=l.default.runWithMetadata(e,t,n,r,i),u=l.default.pullAll();this._connection.write(a,o,!1),this._connection.write(u,o,!0)}}]),t}(c.default);function h(e){e&&"function"==typeof e.prepareToHandleSingleResponse&&e.prepareToHandleSingleResponse()}t.default=f},function(e,t,n){"use strict";var r=n(7);Object.defineProperty(t,"__esModule",{value:!0}),t.SingleConnectionProvider=t.LoadBalancer=t.DirectConnectionProvider=void 0;var i=r(n(12)),o=r(n(15)),a=r(n(16)),u=r(n(9)),s=r(n(10)),c=n(11),l=n(26),f=r(n(27)),h=r(n(69)),d=r(n(74)),v=r(n(75)),_=n(42),p=function(){function e(){(0,u.default)(this,e)}return(0,s.default)(e,[{key:"acquireConnection",value:function(e){throw new Error("Abstract function")}},{key:"_withAdditionalOnErrorCallback",value:function(e,t){return e.catch((function(e){t(e)})),e}}]),e}(),y=function(e){function t(e,n,r){var a;return(0,u.default)(this,t),(a=(0,i.default)(this,(0,o.default)(t).call(this)))._address=e,a._connectionPool=n,a._driverOnErrorCallback=r,a}return(0,a.default)(t,e),(0,s.default)(t,[{key:"acquireConnection",value:function(e){var t=this._connectionPool.acquire(this._address);return this._withAdditionalOnErrorCallback(t,this._driverOnErrorCallback)}}]),t}(p);t.DirectConnectionProvider=y;var g=function(e){function t(e,n,r,a,s,c,l){var f;return(0,u.default)(this,t),(f=(0,i.default)(this,(0,o.default)(t).call(this)))._seedRouter=e,f._routingTable=new h.default,f._rediscovery=new d.default(new v.default(n)),f._connectionPool=r,f._driverOnErrorCallback=c,f._loadBalancingStrategy=a,f._hostNameResolver=s,f._dnsResolver=new _.HostNameResolver,f._log=l,f._useSeedRouter=!0,f}return(0,a.default)(t,e),(0,s.default)(t,[{key:"acquireConnection",value:function(e){var t=this,n=this._freshRoutingTable(e).then((function(n){if(e===l.READ){var r=t._loadBalancingStrategy.selectReader(n.readers);return t._acquireConnectionToServer(r,"read")}if(e===l.WRITE){var i=t._loadBalancingStrategy.selectWriter(n.writers);return t._acquireConnectionToServer(i,"write")}throw(0,c.newError)("Illegal mode "+e)}));return this._withAdditionalOnErrorCallback(n,this._driverOnErrorCallback)}},{key:"forget",value:function(e){this._routingTable.forget(e),this._connectionPool.purge(e)}},{key:"forgetWriter",value:function(e){this._routingTable.forgetWriter(e)}},{key:"_acquireConnectionToServer",value:function(e,t){return e?this._connectionPool.acquire(e):Promise.reject((0,c.newError)("Failed to obtain connection towards ".concat(t," server. Known routing table is: ").concat(this._routingTable),c.SESSION_EXPIRED))}},{key:"_freshRoutingTable",value:function(e){var t=this._routingTable;return t.isStaleFor(e)?(this._log.info("Routing table is stale for ".concat(e,": ").concat(t)),this._refreshRoutingTable(t)):Promise.resolve(t)}},{key:"_refreshRoutingTable",value:function(e){var t=e.routers;return this._useSeedRouter?this._fetchRoutingTableFromSeedRouterFallbackToKnownRouters(t,e):this._fetchRoutingTableFromKnownRoutersFallbackToSeedRouter(t,e)}},{key:"_fetchRoutingTableFromSeedRouterFallbackToKnownRouters",value:function(e,t){var n=this;return this._fetchRoutingTableUsingSeedRouter([],this._seedRouter).then((function(r){return r?(n._useSeedRouter=!1,r):n._fetchRoutingTableUsingKnownRouters(e,t)})).then((function(e){return n._applyRoutingTableIfPossible(e),e}))}},{key:"_fetchRoutingTableFromKnownRoutersFallbackToSeedRouter",value:function(e,t){var n=this;return this._fetchRoutingTableUsingKnownRouters(e,t).then((function(t){return t||n._fetchRoutingTableUsingSeedRouter(e,n._seedRouter)})).then((function(e){return n._applyRoutingTableIfPossible(e),e}))}},{key:"_fetchRoutingTableUsingKnownRouters",value:function(e,n){return this._fetchRoutingTable(e,n).then((function(r){if(r)return r;var i=e.length-1;return t._forgetRouter(n,e,i),null}))}},{key:"_fetchRoutingTableUsingSeedRouter",value:function(e,t){var n=this;return this._resolveSeedRouter(t).then((function(t){var r=t.filter((function(t){return e.indexOf(t)<0}));return n._fetchRoutingTable(r,null)}))}},{key:"_resolveSeedRouter",value:function(e){var t=this;return this._hostNameResolver.resolve(e).then((function(e){return Promise.all(e.map((function(e){return t._dnsResolver.resolve(e)})))})).then((function(e){return[].concat.apply([],e)}))}},{key:"_fetchRoutingTable",value:function(e,n){var r=this;return e.reduce((function(i,o,a){return i.then((function(i){if(i)return i;var u=a-1;return t._forgetRouter(n,e,u),r._createSessionForRediscovery(o).then((function(e){return e?r._rediscovery.lookupRoutingTableOnRouter(e,o).catch((function(e){return r._log.warn("unable to fetch routing table because of an error ".concat(e)),null})):null}))}))}),Promise.resolve(null))}},{key:"_createSessionForRediscovery",value:function(e){return this._connectionPool.acquire(e).then((function(e){var t=new m(e);return new f.default(l.READ,t)})).catch((function(e){if(e&&"Neo.ClientError.Security.Unauthorized"===e.code)throw e;return null}))}},{key:"_applyRoutingTableIfPossible",value:function(e){if(!e)throw(0,c.newError)("Could not perform discovery. No routing servers available. Known routing table: ".concat(this._routingTable),c.SERVICE_UNAVAILABLE);0===e.writers.length&&(this._useSeedRouter=!0),this._updateRoutingTable(e)}},{key:"_updateRoutingTable",value:function(e){this._connectionPool.keepAll(e.allServers()),this._routingTable=e,this._log.info("Updated routing table ".concat(e))}}],[{key:"_forgetRouter",value:function(e,t,n){var r=t[n];e&&r&&e.forgetRouter(r)}}]),t}(p);t.LoadBalancer=g;var m=function(e){function t(e){var n;return(0,u.default)(this,t),(n=(0,i.default)(this,(0,o.default)(t).call(this)))._connection=e,n}return(0,a.default)(t,e),(0,s.default)(t,[{key:"acquireConnection",value:function(e){var t=this._connection;return this._connection=null,Promise.resolve(t)}}]),t}(p);t.SingleConnectionProvider=m},function(e,t,n){"use strict";var r=n(7);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(70)),o=r(n(9)),a=r(n(10)),u=n(8),s=n(26),c=function(){function e(t,n,r,i){(0,o.default)(this,e),this.routers=t||[],this.readers=n||[],this.writers=r||[],this.expirationTime=i||(0,u.int)(0)}return(0,a.default)(e,[{key:"forget",value:function(e){this.readers=l(this.readers,e),this.writers=l(this.writers,e)}},{key:"forgetRouter",value:function(e){this.routers=l(this.routers,e)}},{key:"forgetWriter",value:function(e){this.writers=l(this.writers,e)}},{key:"isStaleFor",value:function(e){return this.expirationTime.lessThan(Date.now())||this.routers.length<1||e===s.READ&&0===this.readers.length||e===s.WRITE&&0===this.writers.length}},{key:"allServers",value:function(){return[].concat((0,i.default)(this.routers),(0,i.default)(this.readers),(0,i.default)(this.writers))}},{key:"toString",value:function(){return"RoutingTable["+"expirationTime=".concat(this.expirationTime,", ")+"currentTime=".concat(Date.now(),", ")+"routers=[".concat(this.routers,"], ")+"readers=[".concat(this.readers,"], ")+"writers=[".concat(this.writers,"]]")}}]),e}();function l(e,t){return e.filter((function(e){return e.asKey()!==t.asKey()}))}t.default=c},function(e,t,n){var r=n(71),i=n(72),o=n(73);e.exports=function(e){return r(e)||i(e)||o()}},function(e,t){e.exports=function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}},function(e,t){e.exports=function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}},function(e,t){e.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}},function(e,t,n){"use strict";var r=n(7);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(9)),o=r(n(10)),a=r(n(69)),u=n(11),s=function(){function e(t){(0,i.default)(this,e),this._routingUtil=t}return(0,o.default)(e,[{key:"lookupRoutingTableOnRouter",value:function(t,n){var r=this;return this._routingUtil.callRoutingProcedure(t,n).then((function(t){if(null===t)return null;if(1!==t.length)throw(0,u.newError)('Illegal response from router "'+n+'". Received '+t.length+" records but expected only one.\n"+JSON.stringify(t),u.PROTOCOL_ERROR);var i=t[0],o=r._routingUtil.parseTtl(i,n),s=r._routingUtil.parseServers(i,n),c=s.routers,l=s.readers,f=s.writers;return e._assertNonEmpty(c,"routers",n),e._assertNonEmpty(l,"readers",n),new a.default(c,l,f,o)}))}}],[{key:"_assertNonEmpty",value:function(e,t,n){if(0===e.length)throw(0,u.newError)("Received no "+t+" from router "+n,u.PROTOCOL_ERROR)}}]),e}();t.default=s},function(e,t,n){"use strict";var r=n(4),i=n(7);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=i(n(9)),a=i(n(10)),u=n(11),s=r(n(8)),c=n(53),l=i(n(33)),f=i(n(35)),h=n(36),d=i(n(76)),v=function(){function e(t){(0,o.default)(this,e),this._routingContext=t}return(0,a.default)(e,[{key:"callRoutingProcedure",value:function(e,t){return this._callAvailableRoutingProcedure(e).then((function(t){return e.close(),t.records})).catch((function(e){if("Neo.ClientError.Procedure.ProcedureNotFound"===e.code)throw(0,u.newError)("Server at ".concat(t.asHostPort()," can't perform routing. Make sure you are connecting to a causal cluster"),u.SERVICE_UNAVAILABLE);return null}))}},{key:"parseTtl",value:function(e,t){try{var n=(0,s.int)(Date.now()),r=(0,s.int)(e.get("ttl")).multiply(1e3).add(n);return r.lessThan(n)?s.default.MAX_VALUE:r}catch(n){throw(0,u.newError)("Unable to parse TTL entry from router ".concat(t," from record:\n").concat(JSON.stringify(e),"\nError message: ").concat(n.message),u.PROTOCOL_ERROR)}}},{key:"parseServers",value:function(e,t){try{var n=e.get("servers"),r=[],i=[],o=[];return n.forEach((function(e){var t=e.role,n=e.addresses;if("ROUTE"===t)r=_(n).map((function(e){return d.default.fromUrl(e)}));else if("WRITE"===t)o=_(n).map((function(e){return d.default.fromUrl(e)}));else{if("READ"!==t)throw(0,u.newError)('Unknown server role "'+t+'"',u.PROTOCOL_ERROR);i=_(n).map((function(e){return d.default.fromUrl(e)}))}})),{routers:r,readers:i,writers:o}}catch(n){throw(0,u.newError)("Unable to parse servers entry from router ".concat(t," from record:\n").concat(JSON.stringify(e),"\nError message: ").concat(n.message),u.PROTOCOL_ERROR)}}},{key:"_callAvailableRoutingProcedure",value:function(e){var t=this;return e._run(null,null,(function(e,n){var r,i,o=e.server.version;c.ServerVersion.fromString(o).compareTo(c.VERSION_3_2_0)>=0?(r="CALL dbms.cluster.routing.getRoutingTable($context)",i={context:t._routingContext}):(r="CALL dbms.cluster.routing.getServers",i={}),e.protocol().run(r,i,l.default.empty(),f.default.empty(),h.ACCESS_MODE_WRITE,n)}))}}]),e}();function _(e){if(!Array.isArray(e))throw new TypeError("Array expected but got: "+e);return Array.from(e)}t.default=v},function(e,t,n){"use strict";var r=n(7);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(9)),o=r(n(10)),a=n(32),u=r(n(77)),s=function(){function e(t,n,r,o){(0,i.default)(this,e),this._host=(0,a.assertString)(t,"host"),this._resolved=n?(0,a.assertString)(n,"resolved"):null,this._port=(0,a.assertNumber)(r,"port"),this._hostPort=o,this._stringValue=n?"".concat(o,"(").concat(n,")"):"".concat(o)}return(0,o.default)(e,[{key:"host",value:function(){return this._host}},{key:"resolvedHost",value:function(){return this._resolved?this._resolved:this._host}},{key:"port",value:function(){return this._port}},{key:"resolveWith",value:function(t){return new e(this._host,t,this._port,this._hostPort)}},{key:"asHostPort",value:function(){return this._hostPort}},{key:"asKey",value:function(){return this._hostPort}},{key:"toString",value:function(){return this._stringValue}}],[{key:"fromUrl",value:function(t){var n=u.default.parseDatabaseUrl(t);return new e(n.host,null,n.port,n.hostAndPort)}}]),e}();t.default=s},function(e,t,n){"use strict";var r=n(7);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(9)),o=n(78),a=n(32),u=7687,s=7474,c=7473,l=function e(t,n,r,o,a){(0,i.default)(this,e),this.scheme=t,this.host=n,this.port=r,this.hostAndPort=o,this.query=a};function f(e,t,n){if(!(e=(e||"").trim()))throw new Error("Illegal empty ".concat(t," in URL query '").concat(n,"'"));return e}function h(e){var t="["===e.charAt(0),n="]"===e.charAt(e.length-1);if(t||n){if(t&&n)return e;throw new Error("Illegal IPv6 address ".concat(e))}return"[".concat(e,"]")}function d(e){return"http"===e?s:"https"===e?c:u}var v={parseDatabaseUrl:function(e){(0,a.assertString)(e,"URL");var t=function(e){if(-1===(e=e.trim()).indexOf("://"))return{schemeMissing:!0,url:"none://".concat(e)};return{schemeMissing:!1,url:e}}(e),n=(0,o.parse)(t.url),r=t.schemeMissing?null:function(e){if(e)return":"===(e=e.trim()).charAt(e.length-1)&&(e=e.substring(0,e.length-1)),e;return null}(n.scheme),i=function(e,t){if(!e)throw new Error("Unable to extract host from ".concat(t));return e.trim()}(n.host),u=function(e){if(!e)throw new Error("Illegal host ".concat(e));return e.indexOf(":")>=0?h(e):e}(i),s=function(e,t){var n=parseInt(e,10);return 0===n||n?n:d(t)}(n.port,r),c="".concat(u,":").concat(s),v=function(e,t){var n=function(e){(e=(e||"").trim())&&"?"===e.charAt(0)&&(e=e.substring(1,e.length));return e}(e),r={};n&&n.split("&").forEach((function(e){var n=e.split("=");if(2!==n.length)throw new Error("Invalid parameters: '".concat(n,"' in URL '").concat(t,"'."));var i=f(n[0],"key",t),o=f(n[1],"value",t);if(r[i])throw new Error("Duplicated query parameters with key '".concat(i,"' in URL '").concat(t,"'"));r[i]=o}));return r}(n.query,e);return new l(r,i,s,c,v)},defaultPortForScheme:d,formatIPv4Address:function(e,t){return"".concat(e,":").concat(t)},formatIPv6Address:function(e,t){var n=h(e);return"".concat(n,":").concat(t)}};t.default=v},function(e,t,n){!function(e){"use strict";function t(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];if(t.length>1){t[0]=t[0].slice(0,-1);for(var r=t.length-1,i=1;i<r;++i)t[i]=t[i].slice(1,-1);return t[r]=t[r].slice(1),t.join("")}return t[0]}function n(e){return"(?:"+e+")"}function r(e){return void 0===e?"undefined":null===e?"null":Object.prototype.toString.call(e).split(" ").pop().split("]").shift().toLowerCase()}function i(e){return e.toUpperCase()}function o(e){var r=t("[0-9]","[A-Fa-f]"),i=n(n("%[EFef]"+r+"%"+r+r+"%"+r+r)+"|"+n("%[89A-Fa-f]"+r+"%"+r+r)+"|"+n("%"+r+r)),o="[\\!\\$\\&\\'\\(\\)\\*\\+\\,\\;\\=]",a=t("[\\:\\/\\?\\#\\[\\]\\@]",o),u=e?"[\\uE000-\\uF8FF]":"[]",s=t("[A-Za-z]","[0-9]","[\\-\\.\\_\\~]",e?"[\\xA0-\\u200D\\u2010-\\u2029\\u202F-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF]":"[]"),c=n("[A-Za-z]"+t("[A-Za-z]","[0-9]","[\\+\\-\\.]")+"*"),l=n(n(i+"|"+t(s,o,"[\\:]"))+"*"),f=(n(n("25[0-5]")+"|"+n("2[0-4][0-9]")+"|"+n("1[0-9][0-9]")+"|"+n("[1-9][0-9]")+"|[0-9]"),n(n("25[0-5]")+"|"+n("2[0-4][0-9]")+"|"+n("1[0-9][0-9]")+"|"+n("0?[1-9][0-9]")+"|0?0?[0-9]")),h=n(f+"\\."+f+"\\."+f+"\\."+f),d=n(r+"{1,4}"),v=n(n(d+"\\:"+d)+"|"+h),_=n(n(d+"\\:")+"{6}"+v),p=n("\\:\\:"+n(d+"\\:")+"{5}"+v),y=n(n(d)+"?\\:\\:"+n(d+"\\:")+"{4}"+v),g=n(n(n(d+"\\:")+"{0,1}"+d)+"?\\:\\:"+n(d+"\\:")+"{3}"+v),m=n(n(n(d+"\\:")+"{0,2}"+d)+"?\\:\\:"+n(d+"\\:")+"{2}"+v),b=n(n(n(d+"\\:")+"{0,3}"+d)+"?\\:\\:"+d+"\\:"+v),k=n(n(n(d+"\\:")+"{0,4}"+d)+"?\\:\\:"+v),w=n(n(n(d+"\\:")+"{0,5}"+d)+"?\\:\\:"+d),E=n(n(n(d+"\\:")+"{0,6}"+d)+"?\\:\\:"),I=n([_,p,y,g,m,b,k,w,E].join("|")),S=n(n(s+"|"+i)+"+"),O=(n(I+"\\%25"+S),n(I+n("\\%25|\\%(?!"+r+"{2})")+S)),T=n("[vV]"+r+"+\\."+t(s,o,"[\\:]")+"+"),C=n("\\["+n(O+"|"+I+"|"+T)+"\\]"),R=n(n(i+"|"+t(s,o))+"*"),N=n(C+"|"+h+"(?!"+R+")|"+R),P=n("[0-9]*"),A=n(n(l+"@")+"?"+N+n("\\:"+P)+"?"),U=n(i+"|"+t(s,o,"[\\:\\@]")),D=n(U+"*"),x=n(U+"+"),j=n(n(i+"|"+t(s,o,"[\\@]"))+"+"),M=n(n("\\/"+D)+"*"),L=n("\\/"+n(x+M)+"?"),F=n(j+M),V=n(x+M),B="(?!"+U+")",q=(n(M+"|"+L+"|"+F+"|"+V+"|"+B),n(n(U+"|"+t("[\\/\\?]",u))+"*")),z=n(n(U+"|[\\/\\?]")+"*"),H=n(n("\\/\\/"+A+M)+"|"+L+"|"+V+"|"+B),W=n(c+"\\:"+H+n("\\?"+q)+"?"+n("\\#"+z)+"?"),Z=n(n("\\/\\/"+A+M)+"|"+L+"|"+F+"|"+B),K=n(Z+n("\\?"+q)+"?"+n("\\#"+z)+"?");return n(W+"|"+K),n(c+"\\:"+H+n("\\?"+q)+"?"),n(n("\\/\\/("+n("("+l+")@")+"?("+N+")"+n("\\:("+P+")")+"?)")+"?("+M+"|"+L+"|"+V+"|"+B+")"),n("\\?("+q+")"),n("\\#("+z+")"),n(n("\\/\\/("+n("("+l+")@")+"?("+N+")"+n("\\:("+P+")")+"?)")+"?("+M+"|"+L+"|"+F+"|"+B+")"),n("\\?("+q+")"),n("\\#("+z+")"),n(n("\\/\\/("+n("("+l+")@")+"?("+N+")"+n("\\:("+P+")")+"?)")+"?("+M+"|"+L+"|"+V+"|"+B+")"),n("\\?("+q+")"),n("\\#("+z+")"),n("("+l+")@"),n("\\:("+P+")"),{NOT_SCHEME:new RegExp(t("[^]","[A-Za-z]","[0-9]","[\\+\\-\\.]"),"g"),NOT_USERINFO:new RegExp(t("[^\\%\\:]",s,o),"g"),NOT_HOST:new RegExp(t("[^\\%\\[\\]\\:]",s,o),"g"),NOT_PATH:new RegExp(t("[^\\%\\/\\:\\@]",s,o),"g"),NOT_PATH_NOSCHEME:new RegExp(t("[^\\%\\/\\@]",s,o),"g"),NOT_QUERY:new RegExp(t("[^\\%]",s,o,"[\\:\\@\\/\\?]",u),"g"),NOT_FRAGMENT:new RegExp(t("[^\\%]",s,o,"[\\:\\@\\/\\?]"),"g"),ESCAPE:new RegExp(t("[^]",s,o),"g"),UNRESERVED:new RegExp(s,"g"),OTHER_CHARS:new RegExp(t("[^\\%]",s,a),"g"),PCT_ENCODED:new RegExp(i,"g"),IPV4ADDRESS:new RegExp("^("+h+")$"),IPV6ADDRESS:new RegExp("^\\[?("+I+")"+n(n("\\%25|\\%(?!"+r+"{2})")+"("+S+")")+"?\\]?$")}}var a=o(!1),u=o(!0),s=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],r=!0,i=!1,o=void 0;try{for(var a,u=e[Symbol.iterator]();!(r=(a=u.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){i=!0,o=e}finally{try{!r&&u.return&&u.return()}finally{if(i)throw o}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},c=2147483647,l=/^xn--/,f=/[^\0-\x7E]/,h=/[\x2E\u3002\uFF0E\uFF61]/g,d={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},v=Math.floor,_=String.fromCharCode;function p(e){throw new RangeError(d[e])}function y(e,t){var n=e.split("@"),r="";n.length>1&&(r=n[0]+"@",e=n[1]);var i=function(e,t){for(var n=[],r=e.length;r--;)n[r]=t(e[r]);return n}((e=e.replace(h,".")).split("."),t).join(".");return r+i}function g(e){for(var t=[],n=0,r=e.length;n<r;){var i=e.charCodeAt(n++);if(i>=55296&&i<=56319&&n<r){var o=e.charCodeAt(n++);56320==(64512&o)?t.push(((1023&i)<<10)+(1023&o)+65536):(t.push(i),n--)}else t.push(i)}return t}var m=function(e,t){return e+22+75*(e<26)-((0!=t)<<5)},b=function(e,t,n){var r=0;for(e=n?v(e/700):e>>1,e+=v(e/t);e>455;r+=36)e=v(e/35);return v(r+36*e/(e+38))},k=function(e){var t,n=[],r=e.length,i=0,o=128,a=72,u=e.lastIndexOf("-");u<0&&(u=0);for(var s=0;s<u;++s)e.charCodeAt(s)>=128&&p("not-basic"),n.push(e.charCodeAt(s));for(var l=u>0?u+1:0;l<r;){for(var f=i,h=1,d=36;;d+=36){l>=r&&p("invalid-input");var _=(t=e.charCodeAt(l++))-48<10?t-22:t-65<26?t-65:t-97<26?t-97:36;(_>=36||_>v((c-i)/h))&&p("overflow"),i+=_*h;var y=d<=a?1:d>=a+26?26:d-a;if(_<y)break;var g=36-y;h>v(c/g)&&p("overflow"),h*=g}var m=n.length+1;a=b(i-f,m,0==f),v(i/m)>c-o&&p("overflow"),o+=v(i/m),i%=m,n.splice(i++,0,o)}return String.fromCodePoint.apply(String,n)},w=function(e){var t=[],n=(e=g(e)).length,r=128,i=0,o=72,a=!0,u=!1,s=void 0;try{for(var l,f=e[Symbol.iterator]();!(a=(l=f.next()).done);a=!0){var h=l.value;h<128&&t.push(_(h))}}catch(e){u=!0,s=e}finally{try{!a&&f.return&&f.return()}finally{if(u)throw s}}var d=t.length,y=d;for(d&&t.push("-");y<n;){var k=c,w=!0,E=!1,I=void 0;try{for(var S,O=e[Symbol.iterator]();!(w=(S=O.next()).done);w=!0){var T=S.value;T>=r&&T<k&&(k=T)}}catch(e){E=!0,I=e}finally{try{!w&&O.return&&O.return()}finally{if(E)throw I}}var C=y+1;k-r>v((c-i)/C)&&p("overflow"),i+=(k-r)*C,r=k;var R=!0,N=!1,P=void 0;try{for(var A,U=e[Symbol.iterator]();!(R=(A=U.next()).done);R=!0){var D=A.value;if(D<r&&++i>c&&p("overflow"),D==r){for(var x=i,j=36;;j+=36){var M=j<=o?1:j>=o+26?26:j-o;if(x<M)break;var L=x-M,F=36-M;t.push(_(m(M+L%F,0))),x=v(L/F)}t.push(_(m(x,0))),o=b(i,C,y==d),i=0,++y}}}catch(e){N=!0,P=e}finally{try{!R&&U.return&&U.return()}finally{if(N)throw P}}++i,++r}return t.join("")},E={version:"2.1.0",ucs2:{decode:g,encode:function(e){return String.fromCodePoint.apply(String,function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}(e))}},decode:k,encode:w,toASCII:function(e){return y(e,(function(e){return f.test(e)?"xn--"+w(e):e}))},toUnicode:function(e){return y(e,(function(e){return l.test(e)?k(e.slice(4).toLowerCase()):e}))}},I={};function S(e){var t=e.charCodeAt(0);return t<16?"%0"+t.toString(16).toUpperCase():t<128?"%"+t.toString(16).toUpperCase():t<2048?"%"+(t>>6|192).toString(16).toUpperCase()+"%"+(63&t|128).toString(16).toUpperCase():"%"+(t>>12|224).toString(16).toUpperCase()+"%"+(t>>6&63|128).toString(16).toUpperCase()+"%"+(63&t|128).toString(16).toUpperCase()}function O(e){for(var t="",n=0,r=e.length;n<r;){var i=parseInt(e.substr(n+1,2),16);if(i<128)t+=String.fromCharCode(i),n+=3;else if(i>=194&&i<224){if(r-n>=6){var o=parseInt(e.substr(n+4,2),16);t+=String.fromCharCode((31&i)<<6|63&o)}else t+=e.substr(n,6);n+=6}else if(i>=224){if(r-n>=9){var a=parseInt(e.substr(n+4,2),16),u=parseInt(e.substr(n+7,2),16);t+=String.fromCharCode((15&i)<<12|(63&a)<<6|63&u)}else t+=e.substr(n,9);n+=9}else t+=e.substr(n,3),n+=3}return t}function T(e,t){function n(e){var n=O(e);return n.match(t.UNRESERVED)?n:e}return e.scheme&&(e.scheme=String(e.scheme).replace(t.PCT_ENCODED,n).toLowerCase().replace(t.NOT_SCHEME,"")),void 0!==e.userinfo&&(e.userinfo=String(e.userinfo).replace(t.PCT_ENCODED,n).replace(t.NOT_USERINFO,S).replace(t.PCT_ENCODED,i)),void 0!==e.host&&(e.host=String(e.host).replace(t.PCT_ENCODED,n).toLowerCase().replace(t.NOT_HOST,S).replace(t.PCT_ENCODED,i)),void 0!==e.path&&(e.path=String(e.path).replace(t.PCT_ENCODED,n).replace(e.scheme?t.NOT_PATH:t.NOT_PATH_NOSCHEME,S).replace(t.PCT_ENCODED,i)),void 0!==e.query&&(e.query=String(e.query).replace(t.PCT_ENCODED,n).replace(t.NOT_QUERY,S).replace(t.PCT_ENCODED,i)),void 0!==e.fragment&&(e.fragment=String(e.fragment).replace(t.PCT_ENCODED,n).replace(t.NOT_FRAGMENT,S).replace(t.PCT_ENCODED,i)),e}function C(e){return e.replace(/^0*(.*)/,"$1")||"0"}function R(e,t){var n=e.match(t.IPV4ADDRESS)||[],r=s(n,2)[1];return r?r.split(".").map(C).join("."):e}function N(e,t){var n=e.match(t.IPV6ADDRESS)||[],r=s(n,3),i=r[1],o=r[2];if(i){for(var a=i.toLowerCase().split("::").reverse(),u=s(a,2),c=u[0],l=u[1],f=l?l.split(":").map(C):[],h=c.split(":").map(C),d=t.IPV4ADDRESS.test(h[h.length-1]),v=d?7:8,_=h.length-v,p=Array(v),y=0;y<v;++y)p[y]=f[y]||h[_+y]||"";d&&(p[v-1]=R(p[v-1],t));var g=p.reduce((function(e,t,n){if(!t||"0"===t){var r=e[e.length-1];r&&r.index+r.length===n?r.length++:e.push({index:n,length:1})}return e}),[]).sort((function(e,t){return t.length-e.length}))[0],m=void 0;if(g&&g.length>1){var b=p.slice(0,g.index),k=p.slice(g.index+g.length);m=b.join(":")+"::"+k.join(":")}else m=p.join(":");return o&&(m+="%"+o),m}return e}var P=/^(?:([^:\/?#]+):)?(?:\/\/((?:([^\/?#@]*)@)?(\[[^\/?#\]]+\]|[^\/?#:]*)(?:\:(\d*))?))?([^?#]*)(?:\?([^#]*))?(?:#((?:.|\n|\r)*))?/i,A=void 0==="".match(/(){0}/)[1];function U(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n={},r=!1!==t.iri?u:a;"suffix"===t.reference&&(e=(t.scheme?t.scheme+":":"")+"//"+e);var i=e.match(P);if(i){A?(n.scheme=i[1],n.userinfo=i[3],n.host=i[4],n.port=parseInt(i[5],10),n.path=i[6]||"",n.query=i[7],n.fragment=i[8],isNaN(n.port)&&(n.port=i[5])):(n.scheme=i[1]||void 0,n.userinfo=-1!==e.indexOf("@")?i[3]:void 0,n.host=-1!==e.indexOf("//")?i[4]:void 0,n.port=parseInt(i[5],10),n.path=i[6]||"",n.query=-1!==e.indexOf("?")?i[7]:void 0,n.fragment=-1!==e.indexOf("#")?i[8]:void 0,isNaN(n.port)&&(n.port=e.match(/\/\/(?:.|\n)*\:(?:\/|\?|\#|$)/)?i[4]:void 0)),n.host&&(n.host=N(R(n.host,r),r)),void 0!==n.scheme||void 0!==n.userinfo||void 0!==n.host||void 0!==n.port||n.path||void 0!==n.query?void 0===n.scheme?n.reference="relative":void 0===n.fragment?n.reference="absolute":n.reference="uri":n.reference="same-document",t.reference&&"suffix"!==t.reference&&t.reference!==n.reference&&(n.error=n.error||"URI is not a "+t.reference+" reference.");var o=I[(t.scheme||n.scheme||"").toLowerCase()];if(t.unicodeSupport||o&&o.unicodeSupport)T(n,r);else{if(n.host&&(t.domainHost||o&&o.domainHost))try{n.host=E.toASCII(n.host.replace(r.PCT_ENCODED,O).toLowerCase())}catch(e){n.error=n.error||"Host's domain name can not be converted to ASCII via punycode: "+e}T(n,a)}o&&o.parse&&o.parse(n,t)}else n.error=n.error||"URI can not be parsed.";return n}var D=/^\.\.?\//,x=/^\/\.(\/|$)/,j=/^\/\.\.(\/|$)/,M=/^\/?(?:.|\n)*?(?=\/|$)/;function L(e){for(var t=[];e.length;)if(e.match(D))e=e.replace(D,"");else if(e.match(x))e=e.replace(x,"/");else if(e.match(j))e=e.replace(j,"/"),t.pop();else if("."===e||".."===e)e="";else{var n=e.match(M);if(!n)throw new Error("Unexpected dot segment condition");var r=n[0];e=e.slice(r.length),t.push(r)}return t.join("")}function F(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.iri?u:a,r=[],i=I[(t.scheme||e.scheme||"").toLowerCase()];if(i&&i.serialize&&i.serialize(e,t),e.host)if(n.IPV6ADDRESS.test(e.host));else if(t.domainHost||i&&i.domainHost)try{e.host=t.iri?E.toUnicode(e.host):E.toASCII(e.host.replace(n.PCT_ENCODED,O).toLowerCase())}catch(n){e.error=e.error||"Host's domain name can not be converted to "+(t.iri?"Unicode":"ASCII")+" via punycode: "+n}T(e,n),"suffix"!==t.reference&&e.scheme&&(r.push(e.scheme),r.push(":"));var o=function(e,t){var n=!1!==t.iri?u:a,r=[];return void 0!==e.userinfo&&(r.push(e.userinfo),r.push("@")),void 0!==e.host&&r.push(N(R(String(e.host),n),n).replace(n.IPV6ADDRESS,(function(e,t,n){return"["+t+(n?"%25"+n:"")+"]"}))),"number"==typeof e.port&&(r.push(":"),r.push(e.port.toString(10))),r.length?r.join(""):void 0}(e,t);if(void 0!==o&&("suffix"!==t.reference&&r.push("//"),r.push(o),e.path&&"/"!==e.path.charAt(0)&&r.push("/")),void 0!==e.path){var s=e.path;t.absolutePath||i&&i.absolutePath||(s=L(s)),void 0===o&&(s=s.replace(/^\/\//,"/%2F")),r.push(s)}return void 0!==e.query&&(r.push("?"),r.push(e.query)),void 0!==e.fragment&&(r.push("#"),r.push(e.fragment)),r.join("")}function V(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r={};return arguments[3]||(e=U(F(e,n),n),t=U(F(t,n),n)),!(n=n||{}).tolerant&&t.scheme?(r.scheme=t.scheme,r.userinfo=t.userinfo,r.host=t.host,r.port=t.port,r.path=L(t.path||""),r.query=t.query):(void 0!==t.userinfo||void 0!==t.host||void 0!==t.port?(r.userinfo=t.userinfo,r.host=t.host,r.port=t.port,r.path=L(t.path||""),r.query=t.query):(t.path?("/"===t.path.charAt(0)?r.path=L(t.path):(void 0===e.userinfo&&void 0===e.host&&void 0===e.port||e.path?e.path?r.path=e.path.slice(0,e.path.lastIndexOf("/")+1)+t.path:r.path=t.path:r.path="/"+t.path,r.path=L(r.path)),r.query=t.query):(r.path=e.path,void 0!==t.query?r.query=t.query:r.query=e.query),r.userinfo=e.userinfo,r.host=e.host,r.port=e.port),r.scheme=e.scheme),r.fragment=t.fragment,r}function B(e,t){return e&&e.toString().replace(t&&t.iri?u.PCT_ENCODED:a.PCT_ENCODED,O)}var q={scheme:"http",domainHost:!0,parse:function(e,t){return e.host||(e.error=e.error||"HTTP URIs must have a host."),e},serialize:function(e,t){return e.port!==("https"!==String(e.scheme).toLowerCase()?80:443)&&""!==e.port||(e.port=void 0),e.path||(e.path="/"),e}},z={scheme:"https",domainHost:q.domainHost,parse:q.parse,serialize:q.serialize},H={},W="[A-Za-z0-9\\-\\.\\_\\~\\xA0-\\u200D\\u2010-\\u2029\\u202F-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF]",Z="[0-9A-Fa-f]",K=n(n("%[EFef][0-9A-Fa-f]%"+Z+Z+"%"+Z+Z)+"|"+n("%[89A-Fa-f][0-9A-Fa-f]%"+Z+Z)+"|"+n("%"+Z+Z)),J=t("[\\!\\$\\%\\'\\(\\)\\*\\+\\,\\-\\.0-9\\<\\>A-Z\\x5E-\\x7E]",'[\\"\\\\]'),Y=new RegExp(W,"g"),G=new RegExp(K,"g"),X=new RegExp(t("[^]","[A-Za-z0-9\\!\\$\\%\\'\\*\\+\\-\\^\\_\\`\\{\\|\\}\\~]","[\\.]",'[\\"]',J),"g"),$=new RegExp(t("[^]",W,"[\\!\\$\\'\\(\\)\\*\\+\\,\\;\\:\\@]"),"g"),Q=$;function ee(e){var t=O(e);return t.match(Y)?t:e}var te={scheme:"mailto",parse:function(e,t){var n=e,r=n.to=n.path?n.path.split(","):[];if(n.path=void 0,n.query){for(var i=!1,o={},a=n.query.split("&"),u=0,s=a.length;u<s;++u){var c=a[u].split("=");switch(c[0]){case"to":for(var l=c[1].split(","),f=0,h=l.length;f<h;++f)r.push(l[f]);break;case"subject":n.subject=B(c[1],t);break;case"body":n.body=B(c[1],t);break;default:i=!0,o[B(c[0],t)]=B(c[1],t)}}i&&(n.headers=o)}n.query=void 0;for(var d=0,v=r.length;d<v;++d){var _=r[d].split("@");if(_[0]=B(_[0]),t.unicodeSupport)_[1]=B(_[1],t).toLowerCase();else try{_[1]=E.toASCII(B(_[1],t).toLowerCase())}catch(e){n.error=n.error||"Email address's domain name can not be converted to ASCII via punycode: "+e}r[d]=_.join("@")}return n},serialize:function(e,t){var n,r=e,o=null!=(n=e.to)?n instanceof Array?n:"number"!=typeof n.length||n.split||n.setInterval||n.call?[n]:Array.prototype.slice.call(n):[];if(o){for(var a=0,u=o.length;a<u;++a){var s=String(o[a]),c=s.lastIndexOf("@"),l=s.slice(0,c).replace(G,ee).replace(G,i).replace(X,S),f=s.slice(c+1);try{f=t.iri?E.toUnicode(f):E.toASCII(B(f,t).toLowerCase())}catch(e){r.error=r.error||"Email address's domain name can not be converted to "+(t.iri?"Unicode":"ASCII")+" via punycode: "+e}o[a]=l+"@"+f}r.path=o.join(",")}var h=e.headers=e.headers||{};e.subject&&(h.subject=e.subject),e.body&&(h.body=e.body);var d=[];for(var v in h)h[v]!==H[v]&&d.push(v.replace(G,ee).replace(G,i).replace($,S)+"="+h[v].replace(G,ee).replace(G,i).replace(Q,S));return d.length&&(r.query=d.join("&")),r}},ne=/^([^\:]+)\:(.*)/,re={scheme:"urn",parse:function(e,t){var n=e.path&&e.path.match(ne),r=e;if(n){var i=t.scheme||r.scheme||"urn",o=n[1].toLowerCase(),a=n[2],u=i+":"+(t.nid||o),s=I[u];r.nid=o,r.nss=a,r.path=void 0,s&&(r=s.parse(r,t))}else r.error=r.error||"URN can not be parsed.";return r},serialize:function(e,t){var n=t.scheme||e.scheme||"urn",r=e.nid,i=n+":"+(t.nid||r),o=I[i];o&&(e=o.serialize(e,t));var a=e,u=e.nss;return a.path=(r||t.nid)+":"+u,a}},ie=/^[0-9A-Fa-f]{8}(?:\-[0-9A-Fa-f]{4}){3}\-[0-9A-Fa-f]{12}$/,oe={scheme:"urn:uuid",parse:function(e,t){var n=e;return n.uuid=n.nss,n.nss=void 0,t.tolerant||n.uuid&&n.uuid.match(ie)||(n.error=n.error||"UUID is not valid."),n},serialize:function(e,t){var n=e;return n.nss=(e.uuid||"").toLowerCase(),n}};I[q.scheme]=q,I[z.scheme]=z,I[te.scheme]=te,I[re.scheme]=re,I[oe.scheme]=oe,e.SCHEMES=I,e.pctEncChar=S,e.pctDecChars=O,e.parse=U,e.removeDotSegments=L,e.serialize=F,e.resolveComponents=V,e.resolve=function(e,t,n){var r=function(e,t){var n=e;if(t)for(var r in t)n[r]=t[r];return n}({scheme:"null"},n);return F(V(U(e,r),U(t,r),r,!0),r)},e.normalize=function(e,t){return"string"==typeof e?e=F(U(e,t),t):"object"===r(e)&&(e=U(F(e,t),t)),e},e.equal=function(e,t,n){return"string"==typeof e?e=F(U(e,n),n):"object"===r(e)&&(e=F(e,n)),"string"==typeof t?t=F(U(t,n),n):"object"===r(t)&&(t=F(t,n)),e===t},e.escapeComponent=function(e,t){return e&&e.toString().replace(t&&t.iri?u.ESCAPE:a.ESCAPE,S)},e.unescapeComponent=B,Object.defineProperty(e,"__esModule",{value:!0})}(t)},function(e,t,n){"use strict";var r=n(7);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(9)),o=r(n(10)),a=r(n(24)),u=n(26),s=r(n(30)),c=function(){function e(t,n){(0,i.default)(this,e),this._connectionProvider=t,this._successCallback=n}return(0,o.default)(e,[{key:"verify",value:function(){var e=this;(function(e){var t=new a.default(u.READ,e);t.initializeConnection();var n=new s.default;return t.getConnection(n).then((function(e){return t.close().then((function(){return e.server}))})).catch((function(e){return t.close().catch((function(e){})).then((function(){return Promise.reject(e)}))}))})(this._connectionProvider).then((function(t){e._successCallback&&e._successCallback(t)})).catch((function(e){}))}}]),e}();t.default=c},function(e,t,n){"use strict";var r=n(7);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(9)),o=r(n(10)),a=n(11),u=function(){function e(t,n,r){(0,i.default)(this,e),this._errorCode=t,this._handleUnavailability=n||s,this._handleWriteFailure=r||s}return(0,o.default)(e,[{key:"errorCode",value:function(){return this._errorCode}},{key:"handleAndTransformError",value:function(e,t){return function(e){if(e)return e.code===a.SESSION_EXPIRED||e.code===a.SERVICE_UNAVAILABLE||"Neo.TransientError.General.DatabaseUnavailable"===e.code;return!1}(e)?this._handleUnavailability(e,t):function(e){if(e)return"Neo.ClientError.Cluster.NotALeader"===e.code||"Neo.ClientError.General.ForbiddenOnReadOnlyDatabase"===e.code;return!1}(e)?this._handleWriteFailure(e,t):e}}]),e}();function s(e){return e}t.default=u},function(e,t,n){"use strict";var r=n(4),i=n(7);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=i(n(9)),a=i(n(10)),u=i(n(12)),s=i(n(15)),c=i(n(16)),l=n(26),f=n(11),h=n(68),d=r(n(82)),v=r(n(85)),_=i(n(80)),p=i(n(86));var y=function(e){function t(e,n,r){var i,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return(0,o.default)(this,t),(i=(0,u.default)(this,(0,s.default)(t).call(this,e,r,a,function(e){if("TRUST_ON_FIRST_USE"===e.trust)throw(0,f.newError)("The chosen trust mode is not compatible with a routing driver");var t=e.resolver;if(t&&"function"!=typeof t)throw new TypeError("Configured resolver should be a function. Got: ".concat(t));return e}(c))))._routingContext=n,i}return(0,c.default)(t,e),(0,a.default)(t,[{key:"_afterConstruction",value:function(){this._log.info("Routing driver ".concat(this._id," created for server address ").concat(this._address))}},{key:"_createConnectionProvider",value:function(e,n,r){var i,o=t._createLoadBalancingStrategy(this._config,n),a=(i=this._config,new p.default(i.resolver));return new h.LoadBalancer(e,this._routingContext,n,o,a,r,this._log)}},{key:"_createConnectionErrorHandler",value:function(){var e=this;return new _.default(f.SESSION_EXPIRED,(function(t,n){return e._handleUnavailability(t,n)}),(function(t,n){return e._handleWriteFailure(t,n)}))}},{key:"_handleUnavailability",value:function(e,t){return this._log.warn("Routing driver ".concat(this._id," will forget ").concat(t," because of an error ").concat(e.code," '").concat(e.message,"'")),this._connectionProvider.forget(t),e}},{key:"_handleWriteFailure",value:function(e,t){return this._log.warn("Routing driver ".concat(this._id," will forget writer ").concat(t," because of an error ").concat(e.code," '").concat(e.message,"'")),this._connectionProvider.forgetWriter(t),(0,f.newError)("No longer possible to write to server at "+t,f.SESSION_EXPIRED)}}],[{key:"_createLoadBalancingStrategy",value:function(e,t){var n=e.loadBalancingStrategy;if(n&&n!==d.LEAST_CONNECTED_STRATEGY_NAME){if(n===v.ROUND_ROBIN_STRATEGY_NAME)return new v.default;throw(0,f.newError)("Unknown load balancing strategy: "+n)}return new d.default(t)}}]),t}(l.Driver);t.default=y},function(e,t,n){"use strict";var r=n(7);Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.LEAST_CONNECTED_STRATEGY_NAME=void 0;var i=r(n(9)),o=r(n(10)),a=r(n(12)),u=r(n(15)),s=r(n(16)),c=r(n(83)),l=r(n(84));t.LEAST_CONNECTED_STRATEGY_NAME="least_connected";var f=function(e){function t(e){var n;return(0,i.default)(this,t),(n=(0,a.default)(this,(0,u.default)(t).call(this)))._readersIndex=new c.default,n._writersIndex=new c.default,n._connectionPool=e,n}return(0,s.default)(t,e),(0,o.default)(t,[{key:"selectReader",value:function(e){return this._select(e,this._readersIndex)}},{key:"selectWriter",value:function(e){return this._select(e,this._writersIndex)}},{key:"_select",value:function(e,t){var n=e.length;if(0===n)return null;var r=t.next(n),i=r,o=null,a=Number.MAX_SAFE_INTEGER;do{var u=e[i],s=this._connectionPool.activeResourceCount(u);s<a&&(o=u,a=s),i===n-1?i=0:i++}while(i!==r);return o}}]),t}(l.default);t.default=f},function(e,t,n){"use strict";var r=n(7);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(9)),o=r(n(10)),a=function(){function e(t){(0,i.default)(this,e),this._offset=t||0}return(0,o.default)(e,[{key:"next",value:function(e){if(0===e)return-1;var t=this._offset;return this._offset+=1,this._offset===Number.MAX_SAFE_INTEGER&&(this._offset=0),t%e}}]),e}();t.default=a},function(e,t,n){"use strict";var r=n(7);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(9)),o=r(n(10)),a=function(){function e(){(0,i.default)(this,e)}return(0,o.default)(e,[{key:"selectReader",value:function(e){throw new Error("Abstract function")}},{key:"selectWriter",value:function(e){throw new Error("Abstract function")}}]),e}();t.default=a},function(e,t,n){"use strict";var r=n(7);Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.ROUND_ROBIN_STRATEGY_NAME=void 0;var i=r(n(9)),o=r(n(10)),a=r(n(12)),u=r(n(15)),s=r(n(16)),c=r(n(83)),l=r(n(84));t.ROUND_ROBIN_STRATEGY_NAME="round_robin";var f=function(e){function t(){var e;return(0,i.default)(this,t),(e=(0,a.default)(this,(0,u.default)(t).call(this)))._readersIndex=new c.default,e._writersIndex=new c.default,e}return(0,s.default)(t,e),(0,o.default)(t,[{key:"selectReader",value:function(e){return this._select(e,this._readersIndex)}},{key:"selectWriter",value:function(e){return this._select(e,this._writersIndex)}},{key:"_select",value:function(e,t){var n=e.length;return 0===n?null:e[t.next(n)]}}]),t}(l.default);t.default=f},function(e,t,n){"use strict";var r=n(7);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(9)),o=r(n(10)),a=r(n(76));function u(e){return Promise.resolve([e])}var s=function(){function e(t){(0,i.default)(this,e),this._resolverFunction=t||u}return(0,o.default)(e,[{key:"resolve",value:function(e){var t=this;return new Promise((function(n){return n(t._resolverFunction(e.asHostPort()))})).then((function(e){if(!Array.isArray(e))throw new TypeError("Configured resolver function should either return an array of addresses or a Promise resolved with an array of addresses."+"Each address is '<host>:<port>'. Got: ".concat(e));return e.map((function(e){return a.default.fromUrl(e)}))}))}}]),e}();t.default=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;t.default="0.0.0-dev"},function(e,t,n){"use strict";var r=n(7);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(9)),o=r(n(10)),a=r(n(12)),u=r(n(15)),s=r(n(16)),c=r(n(26)),l=r(n(89)),f=r(n(92)),h=r(n(76)),d=function(e){function t(e,n,r,o){var s;return(0,i.default)(this,t),(s=(0,a.default)(this,(0,u.default)(t).call(this,h.default.fromUrl(e.hostAndPort),n,r,o)))._url=e,s._sessionTracker=new f.default,s}return(0,s.default)(t,e),(0,o.default)(t,[{key:"session",value:function(){return new l.default(this._url,this._authToken,this._config,this._sessionTracker)}},{key:"close",value:function(){return this._sessionTracker.close()}}]),t}(c.default);t.default=d},function(e,t,n){"use strict";var r=n(7);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(9)),o=r(n(10)),a=r(n(12)),u=r(n(15)),s=r(n(14)),c=r(n(16)),l=n(26),f=r(n(27)),h=n(32),d=n(11),v=r(n(90)),_=n(24),p=r(n(22)),y=function(e){function t(e,n,r,o){var c;return(0,i.default)(this,t),(c=(0,a.default)(this,(0,u.default)(t).call(this,l.WRITE,null,null,r)))._ongoingTransactionIds=[],c._serverInfoSupplier=function(e){return function(){return{server:{address:e.hostAndPort}}}}(e),c._requestRunner=new v.default(e,n),c._sessionTracker=o,c._sessionTracker.sessionOpened((0,s.default)(c)),c}return(0,c.default)(t,e),(0,o.default)(t,[{key:"run",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=(0,h.validateStatementAndParameters)(e,n),i=r.query,o=r.params;return this._requestRunner.beginTransaction().then((function(e){return t._ongoingTransactionIds.push(e),t._requestRunner.runQuery(e,i,o).then((function(n){return n.hasFailed()?g(e,n,t._requestRunner):m(e,n,t._requestRunner)})).then((function(n){return t._ongoingTransactionIds=t._ongoingTransactionIds.filter((function(t){return t!==e})),new p.default(n,i,o,t._serverInfoSupplier,_.EMPTY_CONNECTION_HOLDER)}))}))}},{key:"beginTransaction",value:function(){k()}},{key:"readTransaction",value:function(){k()}},{key:"writeTransaction",value:function(){k()}},{key:"lastBookmark",value:function(){throw new d.Neo4jError("Experimental HTTP driver does not support bookmarks and routing")}},{key:"close",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){return null},n=this._ongoingTransactionIds.map((function(t){return b(t,e._requestRunner)}));Promise.all(n).then((function(){e._sessionTracker.sessionClosed(e),t()}))}}]),t}(f.default);function g(e,t,n){return b(e,n).then((function(){return t}))}function m(e,t,n){return n.commitTransaction(e).catch((function(e){t.onError(e)})).then((function(){return t}))}function b(e,t){return t.rollbackTransaction(e).catch((function(){}))}function k(){throw new d.Neo4jError("Experimental HTTP driver does not support transactions")}t.default=y},function(e,t,n){"use strict";var r=n(7);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(9)),o=r(n(10)),a=r(n(30)),u=r(n(91)),s=n(11),c=function(){function e(t,n){(0,i.default)(this,e),this._url=t,this._authToken=n,this._converter=new u.default}return(0,o.default)(e,[{key:"beginTransaction",value:function(){var e=this;return l("POST",h(this._url),null,this._authToken).then((function(t){var n=e._converter.extractError(t);if(n)throw n;return e._converter.extractTransactionId(t)}))}},{key:"commitTransaction",value:function(e){var t=this;return l("POST",function(e,t){return d(e,t)+"/commit"}(this._url,e),null,this._authToken).then((function(e){var n=t._converter.extractError(e);if(n)throw n}))}},{key:"rollbackTransaction",value:function(e){var t=this;return l("DELETE",d(this._url,e),null,this._authToken).then((function(e){var n=t._converter.extractError(e);if(n)throw n}))}},{key:"runQuery",value:function(e,t,n){var r=this,i=new a.default,o=d(this._url,e),u=function(e,t,n,r){try{return function(e,t,n){var r=n.encodeStatementParameters(t);return JSON.stringify({statements:[{statement:e,parameters:r,resultDataContents:["row","graph"],includeStats:!0}]})}(e,t,n)}catch(e){return r.onError(e),null}}(t,n,this._converter,i);return u?l("POST",o,u,this._authToken).then((function(e){!function(e,t,n){if(!e)return;try{!function(e,t,n){var r=t.extractError(e);if(r)n.onError(r);else{var i=t.extractRecordMetadata(e);n.onCompleted(i),t.extractRawRecords(e).forEach((function(e){return n.onNext(e)}));var o=t.extractStatementMetadata(e);n.onCompleted(o)}}(e,t,n)}catch(e){n.onError(e)}}(e,r._converter,i)})).catch((function(e){i.onError(e)})).then((function(){return i})):Promise.resolve(i)}}]),e}();function l(e,t,n,r){try{var i={method:e,headers:f(r),body:n};return new Promise((function(e,n){fetch(t,i).then((function(e){return e.json()})).then((function(t){return e(t)})).catch((function(e){return n(new s.Neo4jError(e.message,s.SERVICE_UNAVAILABLE))}))}))}catch(e){return Promise.reject(e)}}function f(e){var t=new Headers;return t.append("Accept","application/json; charset=UTF-8"),t.append("Content-Type","application/json"),t.append("Authorization","Basic "+btoa(e.principal+":"+e.credentials)),t}function h(e){return function(e,t){return"".concat(e.scheme,"://").concat(e.host,":").concat(e.port).concat(t)}(e,"/db/data/transaction")}function d(e,t){return h(e)+"/"+t}t.default=c},function(e,t,n){"use strict";var r=n(7);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(20)),o=r(n(70)),a=r(n(13)),u=r(n(9)),s=r(n(10)),c=n(8),l=n(21),f=n(11),h=n(60),d=n(61),v=function(){function e(){(0,u.default)(this,e)}return(0,s.default)(e,[{key:"encodeStatementParameters",value:function(e){return _(e)}},{key:"extractError",value:function(e){var t=e.errors;if(t){var n=t[0];if(n){var r=e.password_change?"Neo.ClientError.Security.CredentialsExpired":n.code,i=n.message;return new f.Neo4jError(i,r)}}return null}},{key:"extractTransactionId",value:function(e){var t=e.commit;if(t){var n=t.replace("/commit",""),r=n.substring(n.lastIndexOf("/")+1),i=parseInt(r,10);if(i||0===i)return i}throw new f.Neo4jError("Unable to extract transaction id from the response JSON: ".concat(JSON.stringify(e)))}},{key:"extractRecordMetadata",value:function(e){var t=y(e);return{fields:t?t.columns:[]}}},{key:"extractRawRecords",value:function(e){var t=y(e);if(t){var n=t.data;if(n)return n.map((function(e){return function(e){var t=e.row,n=function(e){var t=e.graph;if(t){var n=t.nodes;if(n)return n.reduce((function(e,t){var n=m(t.id),r=t.labels,i=g(t.properties);return e[t.id]=new l.Node(n,r,i),e}),{})}return{}}(e),r=function(e){var t=e.graph;if(t){var n=t.relationships;if(n)return n.reduce((function(e,t){var n=m(t.id),r=m(t.startNode),i=m(t.endNode),o=t.type,a=g(t.properties);return e[t.id]=new l.Relationship(n,r,i,o,a),e}),{})}return{}}(e);if(t)return t.map((function(t,a){return function(e,t,n,r){var a=t.row?t.row[e]:null,u=t.meta?t.meta[e]:null;return u?function(e,t,n,r){return a=t,b("node",a)?n[t.id]:function(e){return b("relationship",e)}(t)?r[t.id]:function(e){return Array.isArray(e)}(t)?function(e,t,n){for(var r=null,i=null,o=[],a=0;a<e.length;a++){var u=e[a],s=u.id,c=u.type,h=null===r&&null===i||null!==r&&null!==i;if(h&&"node"!==c)throw new f.Neo4jError("Unable to parse path, node expected but got: ".concat(JSON.stringify(u)," in ").concat(JSON.stringify(e)));if(!h&&"node"===c)throw new f.Neo4jError("Unable to parse path, relationship expected but got: ".concat(JSON.stringify(u)," in ").concat(JSON.stringify(e)));if(h){var d=t[s];if(null===r)r=d;else{if(null===r||null===i)throw new f.Neo4jError("Unable to parse path, illegal node configuration: ".concat(JSON.stringify(e)));var v=new l.PathSegment(r,i,d);o.push(v),r=d,i=null}}else{if(null!==i)throw new f.Neo4jError("Unable to parse path, illegal relationship configuration: ".concat(JSON.stringify(e)));i=n[s]}}var _=o[o.length-1];if(_&&_.end!==r||null!==i)throw new f.Neo4jError("Unable to parse path: ".concat(JSON.stringify(e)));return function(e){var t=e[0].start,n=e[e.length-1].end;return new l.Path(t,n,e)}(o)}(t,n,r):function(e){return b("point",e)}(t)?function(e){if("Point"!==e.type)throw new f.Neo4jError("Unexpected Point type received: ".concat(JSON.stringify(e)));var t=e.coordinates;if(!Array.isArray(t)&&(2!==t.length||3!==t.length))throw new f.Neo4jError("Unexpected Point coordinates received: ".concat(JSON.stringify(e)));var n=function(e){var t=e.crs;if(!t||!t.name)throw new f.Neo4jError("Unexpected Point crs received: ".concat(JSON.stringify(e)));var n=t.name.toLowerCase();if("wgs-84"===n)return 4326;if("wgs-84-3d"===n)return 4979;if("cartesian"===n)return 7203;if("cartesian-3d"===n)return 9157;throw new f.Neo4jError("Unexpected Point crs received: ".concat(JSON.stringify(e)))}(e);return(0,i.default)(h.Point,[n].concat((0,o.default)(t)))}(e):e;var a}(a,u,n,r):g(a)}(a,e,n,r)}));return[]}(e)}))}return[]}},{key:"extractStatementMetadata",value:function(e){var t=y(e);if(t){var n=t.stats;if(n)return{stats:Object.keys(n).reduce((function(e,t){return"contains_updates"===t?e:(e[("relationship_deleted"===t?"relationships_deleted":t).replace("_","-")]=n[t],e)}),{})}}return{}}}]),e}();function _(e){return e&&"object"===(0,a.default)(e)?Object.keys(e).reduce((function(t,n){return t[n]=function e(t){if(t instanceof l.Node)throw new f.Neo4jError("It is not allowed to pass nodes in query parameters",f.PROTOCOL_ERROR);if(t instanceof l.Relationship)throw new f.Neo4jError("It is not allowed to pass relationships in query parameters",f.PROTOCOL_ERROR);if(t instanceof l.Path)throw new f.Neo4jError("It is not allowed to pass paths in query parameters",f.PROTOCOL_ERROR);if((0,h.isPoint)(t))throw p("points");if((0,d.isDate)(t))throw p("dates");if((0,d.isDateTime)(t))throw p("date-time");if((0,d.isDuration)(t))throw p("durations");if((0,d.isLocalDateTime)(t))throw p("local date-time");if((0,d.isLocalTime)(t))throw p("local time");if((0,d.isTime)(t))throw p("time");return(0,c.isInt)(t)?t.toNumber():Array.isArray(t)?t.map((function(t){return e(t)})):"object"===(0,a.default)(t)?_(t):t}(e[n]),t}),{}):e}function p(e){return new f.Neo4jError("It is not allowed to pass ".concat(e," in query parameters when using HTTP endpoint. ")+"Please consider using Cypher functions to create ".concat(e," so that query parameters are plain objects."),f.PROTOCOL_ERROR)}function y(e){var t=e.results;if(t){var n=t[0];if(n)return n}return null}function g(e){return null==e||void 0===e?null:"number"==typeof e?m(e):Array.isArray(e)?e.map((function(e){return g(e)})):"object"===(0,a.default)(e)?Object.keys(e).reduce((function(t,n){return t[n]=g(e[n]),t}),{}):e}function m(e){return"number"==typeof e?e:Number(e)}function b(e,t){return!Array.isArray(t)&&"object"===(0,a.default)(t)&&t.type===e}t.default=v},function(e,t,n){"use strict";var r=n(7);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(9)),o=r(n(10)),a=function(){function e(){(0,i.default)(this,e),this._openSessions=new Set}return(0,o.default)(e,[{key:"sessionOpened",value:function(e){this._openSessions.add(e)}},{key:"sessionClosed",value:function(e){this._openSessions.delete(e)}},{key:"close",value:function(){var e=Array.from(this._openSessions);return this._openSessions.clear(),Promise.all(e.map((function(e){return function(e){return new Promise((function(t){e.close((function(){t()}))}))}(e)})))}}]),e}();t.default=a},function(e,t,n){"use strict";n.r(t),n.d(t,"csvFormat",(function(){return i})),n.d(t,"stringFormat",(function(){return o}));var r=n(3);const i=e=>"number"==typeof e?a(e):r.v1.isInt(e)?e.toString():e instanceof r.v1.types.Point?u(e):s(e)?`"${e.toString()}"`:"string"==typeof e?e:void 0,o=e=>"number"==typeof e?a(e):r.v1.isInt(e)?e.toString():e instanceof r.v1.types.Point?u(e):s(e)?`"${e.toString()}"`:void 0,a=e=>{if(Math.floor(e)===e)return`${e}.0`},u=e=>{const t=e.z?`, z:${e.z}`:"";return`point({srid:${e.srid}, x:${e.x}, y:${e.y}${t}})`},s=e=>e instanceof r.v1.types.Date||e instanceof r.v1.types.DateTime||e instanceof r.v1.types.Duration||e instanceof r.v1.types.LocalDateTime||e instanceof r.v1.types.LocalTime||e instanceof r.v1.types.Time}]).default}));